<!DOCTYPE html>
<html lang="en-us" class="js csstransforms3d _Skins_HTML5___Side_Navigation" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Home Page|Installation Guide">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>
              
              Reverse Proxy
              </title>
        <link href="../../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <script src="../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body class="" data-url="../../installation-guide/reverse-proxy/">
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="title tab bar" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../index.html" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div id="mc-main-content" role="main" data-mc-content-body="True">
                                    <section id="body">
                                        <div id="body-inner">
                                            <h1>
                                                <div>
              
              Reverse Proxy
              </div>
                                            </h1>
                                            <p><span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>&#160;can be installed behind a <a href="https://en.wikipedia.org/wiki/Reverse_proxy" target="_blank" title="reverse proxy" alt="reverse proxy">reverse proxy</a> that acts as an intermediate server between users and <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>'s server, in order to process users' requests and redirect them to the right server(s), for performance and security purposes.</p>
                                            <h2 id="overview">Overview</h2>
                                            <p>A reverse proxy is usually used when:</p>
                                            <ul>
                                                <li>
                                                    <p>needing to encrypt the requests from/to end-users on the one hand, and on the other hand to be able to monitor plain text requests from/to <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>'s server;</p>
                                                    <p style="text-align: center;">
                                                        <img src="../../../Resources/Images/Proxy_purpose_encryption.png" alt="Proxy Purposes: Encryption" style="box-shadow: none;width: 1014px;height: 420px;" />
                                                    </p>
                                                </li>
                                                <li>
                                                    <p>installing <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>&#160;with an integrated agent on a network isolated from the users' browsers, in order to be able to access sensitive systems which are protected by being set up on a network isolated from the Internet;</p>
                                                    <p style="text-align: center;">
                                                        <img src="../../../Resources/Images/Proxy_example.png" alt="Proxy Installation Example" style="box-shadow: none;width: 1019px;height: 834px;" />
                                                    </p>
                                                    <div class="notices note">
                                                        <p>This installation will be used for the configuration examples below.</p>
                                                    </div>
                                                </li>
                                                <li>
                                                    <p>using several <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>'s server instances for load-balancing purposes.</p>
                                                    <p style="text-align: center;">
                                                        <img src="../../../Resources/Images/Proxy_purpose_loadBalancing.png" alt="Proxy Purposes: Load Balancing" style="box-shadow: none;width: 1245px;height: 964px;" />
                                                    </p>
                                                </li>
                                            </ul>
                                            <div class="notices info">
                                                <p>As <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>&#160;is session-less, working with several servers does not imply the need to synchronize sessions between servers, nor the need to guarantee that a particular IP will be processed by a particular server.</p>
                                            </div>
                                            <h3 id="nginx">Nginx</h3>
                                            <p>For these tasks, <a href="https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/#" target="_blank" title="nginx" alt="nginx">nginx</a> is a relevant choice of reverse proxy. There are several versions of nginx available, suitable for several Linux-based environments. <a href="https://docs.nginx.com/nginx/admin-guide/installing-nginx/" target="_blank" title="Installation instructions" alt="Installation instructions">Installation instructions</a> can be found directly on the nginx website.</p>
                                            <p>At its core, <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>&#160;is an ASP.NET application with a Kestrel server. We can configure a nginx reverse proxy accordingly by following <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-8.0&amp;tabs=linux-ubuntu#configure-nginx-2" target="_blank" title="Microsoft's guidelines" alt="Microsoft's guidelines">Microsoft's guidelines</a>.</p>
                                            <p>Nginx <a href="https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/">configuration files</a> are usually located in <code>/etc/nginx</code>.</p>
                                            <h3 id="load-balancing">Load balancing</h3>
                                            <p>Nginx offers several <a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/#choosing-a-load-balancing-method" target="_blank" title="load balancing methods" alt="load balancing methods">load balancing methods</a> which are all compatible with <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>.</p>
                                            <p>Then, in order for servers to be able to properly schedule and coordinate synchronization and provisioning, the following file locations must be shared by all <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>&#160;servers:</p>
                                            <ul>
                                                <li>TempFolderPath</li>
                                                <li>WorkFolderPath</li>
                                            </ul>
                                            <p>All <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>&#160;servers also share a database. See the <a href="../../integration-guide/network-configuration/agent-configuration/appsettings/index.html" target="_parent" title="Application Settings" alt="Application Settings" class="MCXref xref">Application Settings</a> topic for additional information.</p>
                                            <h2 id="basic-configuration">Basic Configuration</h2>
                                            <p>The following is a basic configuration, in the <code>nginx.conf</code> file, with one virtual host, that directs incoming requests on  <code>&lt;listening-port&gt;</code> from network 1 to a <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>&#160;server instance at <code>&lt;Usercube-server-url&gt;</code> on network 2.</p><pre class="chroma" xml:space="preserve"><code>
<em>nginx.conf</em>

worker_processes auto;

http {

	##
	# Basic Settings
	##

	sendfile on;
	tcp_nopush on;
	tcp_nodelay on;
	keepalive_timeout 65;
	types_hash_max_size 2048;
	default_type application/octet-stream;

	##
	# SSL Settings
	##

	ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE
	ssl_prefer_server_ciphers on;

	##
	# Logging Settings
	##

	access_log /nginx-1.19.7/logs/access.log;
	error_log /nginx-1.19.7/logs/error.log;

	##
	# Gzip Settings
	##

	gzip on;

	##
	# Virtual Host Configs
	##


	server {
		listen       &lt;listening-port&gt; default_server;
		server_name  &lt;server-name&gt;;

		location / {
			proxy_pass         http://&lt;Usercube-server-url&gt;;
			proxy_http_version 1.1;
			proxy_set_header   Upgrade $http_upgrade;
			proxy_set_header   Connection keep-alive;
			proxy_set_header   Host $host;
			proxy_cache_bypass $http_upgrade;
			proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header   X-Forwarded-Proto $scheme;
			proxy_set_header   X-Real-IP $remote_addr;
		}
	}
}
</code></pre>
                                            <p>Where:</p>
                                            <ul>
                                                <li><code>&lt;listening-port&gt;</code> is the port that nginx listens to on network 1 for incoming HTTP requests. It should be set to <code>80</code>, except if you have another web server listening for port 80 requests and passing them to your nginx server.</li>
                                                <li><code>&lt;server-name&gt;</code> is the URL used by end-users to request <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>'s server, such as <code>contoso.usercube.com</code>. It is the content of the host header in the incoming HTTP request.</li>
                                                <li><code>&lt;Usercube-server-url&gt;</code> is <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>'s server URL on network 2.</li>
                                            </ul>
                                            <div class="notices note">
                                                <p>With this configuration, SSL is enabled between the nginx proxy and the client, but not between the proxy and <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>'s server. <code>gzip</code> is used to compress files to be sent over the network.</p>
                                            </div>
                                            <h3 id="static-files">Static files</h3>
                                            <p>Performance can be enhanced for static file serving. This requires extracting static files such as the UI JavaScript application and the logo and pictures, and storing them on the nginx server directly.See more information about <a href="https://docs.nginx.com/nginx/admin-guide/web-server/serving-static-content/" target="_blank" title="static file serving with nginx" alt="static file serving with nginx">static file serving with nginx</a>.</p>
                                            <h2 id="load-balancing-configuration">Load Balancing Configuration</h2>
                                            <p>Load balancing involves at least two <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>&#160;servers to which <a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/" target="_blank" title="nginx, acting as a load balancer" alt="nginx, acting as a load balancer">nginx, acting as a load balancer</a>, distributes the load of incoming requests.</p>
                                            <p>Then, in addition to the configuration from the previous example, a group of servers must be declared, using the <code>upstream</code> directive in the <code>http</code> section.</p>
                                            <p>The following configuration defines a group named <code>usercubegroup</code> which contains two server configurations, each one resolving to an actual <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>'s server instance:</p><pre class="chroma" xml:space="preserve"><code>
...
http {
    upstream usercubegroup {
        server usercube1.contoso.com;
        server usercube2.contoso.com;
    }
    ...
}
...
</code></pre>
                                            <p>Then, the name of the group takes the place of <code>&lt;Usercube-server-url&gt;</code> in the virtual host definition:</p><pre class="chroma" xml:space="preserve"><code>
server {
        listen       &lt;listening-port&gt; default_server;
        server_name  &lt;server-name&gt;;

		location / {
	        proxy_pass         http://<b>IdentityManagergroup</b>;
	        proxy_http_version 1.1;
	        proxy_set_header   Upgrade $http_upgrade;
	        proxy_set_header   Connection keep-alive;
	        proxy_set_header   Host $host;
	        proxy_cache_bypass $http_upgrade;
	        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
	        proxy_set_header   X-Forwarded-Proto $scheme;
		    proxy_set_header   X-Real-IP $remote_addr;
	   }

	}
</code></pre>
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>