<!DOCTYPE html>
<html lang="en-us" class="js csstransforms3d _Skins_HTML5___Side_Navigation" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Home Page|Integration Guide|Network Configuration">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>
              
              Proxy Server
              </title>
        <link href="../../../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <script src="../../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body class="" data-url="../../../integration-guide/network-configuration/proxy/">
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="title tab bar" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../index.html" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div id="mc-main-content" role="main" data-mc-content-body="True">
                                    <section id="body">
                                        <div id="body-inner">
                                            <h1>
                                                <div>
              
              Proxy Server
              </div>
                                            </h1>
                                            <p><span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>&#160;server or agent can be configured to go through a proxy server to access internal or external web resources.</p>
                                            <h2 id="introduction">Introduction</h2>
                                            <p>A <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span> agent often needs to access internal or external systems using the HTTP protocol. It may easily be configured to use a proxy server through which all or part of the HTTP traffic will be routed.</p>
                                            <h2 id="proxy-related-environment-variables">Proxy Related Environment Variables</h2>
                                            <p>The proxy configuration is based on a set of standard dotnet environment variables:</p>
                                            <ul>
                                                <li><code>HTTPS_PROXY</code>: the proxy server used on HTTPS requests.</li>
                                                <li><code>NO_PROXY</code>: a comma-separated list of hostnames that should be excluded from proxying.</li>
                                            </ul>
                                            <div class="notices note">
                                                <p>The dotnet environment does not rely on the OS-wide proxy configuration.
It is mandatory to use the above-mentioned environment variables to configure the proxy.</p>
                                            </div>
                                            <h3 id="https_proxy">HTTPS_PROXY</h3>
                                            <p>The <code>HTTPS_PROXY</code> environment variable may be the hostname or IP address, optionally followed by a colon and port number, or it may be an http URL, optionally including a username and password for <a href="#" target="_parent" title="Proxy Server" alt="Proxy Server" class="MCXref xref" xrefformat="{para}">
              
              Proxy Server
              </a>authentication.</p>
                                            <div class="notices warning">
                                                <p>The URL must start with <code>http</code>, <strong>not https</strong>, and cannot include any text after the hostname, IP, or port.</p>
                                            </div>
                                            <p>This example shows various ways to properly configure a proxy server using Powershell:</p><pre class="powershell" xml:space="preserve"><code>
# <b>A hostname with port (recommended syntax)</b>
$env:HTTPS_PROXY="proxy.contoso.com:6060"
# A hostname without port
$env:HTTPS_PROXY="proxy.contoso.com"
# An IP address with port
$env:HTTPS_PROXY="10.65.1.1:6060"
# A URL with port:
# <b>Warning: Even if we want to route HTTPS traffic, we MUST give a URL with http scheme</b>.
# <b>Warning: Do not add trailing slash</b>.
$env:HTTPS_PROXY="http://proxy.contoso.com:6060"
</code></pre>
                                            <div class="notices note">
                                                <p>We recommend using the <code>&lt;hostname&gt;:&lt;port&gt;</code> syntax since it is not misleading.
We discourage using the <code>http://&lt;hostname&gt;:&lt;port&gt;</code> syntax since it is not intuitive to indicate the <code>http</code> scheme to route <code>https</code> traffic.
However, if you decide to use this syntax, do not forget to include a comment stating that <code>http</code> scheme is mandatory at the configuration level, even if it will not be used at runtime.</p>
                                            </div>
                                            <h4 id="do-not-do">Do not do</h4>
                                            <div class="notices warning">
                                                <p>This example shows the wrong ways to initialize the <code>HTTPS_PROXY</code> environment variable.
The environment variable will be <strong>silently ignored</strong> and the traffic will not be routed through the proxy.</p>
                                            </div><pre class="powershell" xml:space="preserve"><code>
# WRONG: A URL with https scheme
$env:HTTPS_PROXY="https://proxy.contoso.com:6060"
# WRONG: A URL with text after the port number
$env:HTTPS_PROXY="http://proxy.contoso.com:6060/"
# WRONG: A URL with text after the hostname
$env:HTTPS_PROXY="http://proxy.contoso.com/"
</code></pre>
                                            <h4 id="authenticated-proxy">Authenticated proxy</h4>
                                            <p>When the proxy server needs the user to be authenticated, the <code>HTTPS_PROXY</code> environment variable can include the username and password as follows:</p><pre class="powershell" xml:space="preserve"><code>
# A URL to authenticate to the proxy with login=mylogin and password=mypassword
$env:HTTPS_PROXY="http://mylogin:mypassword@proxy.contoso.com:6060"
</code></pre>
                                            <h3 id="no_proxy">NO_PROXY</h3>
                                            <p>The <code>NO_PROXY</code> environment variable is a comma-separated list of hostnames that should be excluded from proxying.
To exclude all subdomains ("wildcard" exclusion), domains in the <code>NO_PROXY</code> list need to be prefixed with a dot (<code>.</code>), which is standard, but not particularly well documented. <strong>Do not use the star (<code>*</code>) prefix !!!</strong></p>
                                            <p>This example shows various ways to exclude domains from proxying:</p><pre class="powershell" xml:space="preserve"><code>
# Exclude only www.google.com:
# www.google.com: will not go through the proxy
# maps.google.com: will go through the proxy
$env:NO_PROXY="www.google.com"
# Exclude only www.google.com and www.microsoft.com:
$env:NO_PROXY="www.google.com,www.microsoft.com"
# Exclude all google.com and all microsoft.com subdomains:
# <b>Do not prepend the domain name with a '*'</b>
# www.google.com: will not go through the proxy
# maps.google.com: will not go through the proxy
# www.microsoft.com: will not go through the proxy
$env:NO_PROXY=".google.com,.microsoft.com"
</code></pre>
                                            <h4 id="do-not-do-1">Do not do</h4>
                                            <div class="notices warning">
                                                <p>This example shows the wrong ways to initialize the <code>NO_PROXY</code> environment variable.</p>
                                            </div><pre class="powershell" xml:space="preserve"><code>
# WRONG: starting with '*' to indicate a wildcard exclusion
# Only the domain exactly named *.contoso.com will be excluded from proxying,
# which means there is no exclusion configured.
$env:NO_PROXY="*.contoso.com"
</code></pre>
                                            <h2 id="where-to-define-proxy-environment-variables">Where to Define Proxy Environment Variables</h2>
                                            <p>The proxy configuration is based on a set of standard dotnet environment variables, they can be defined in various places according to the practices in place in your organization:</p>
                                            <ul>
                                                <li>At OS level</li>
                                                <li>At user level: for the user running the <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span> server or agent</li>
                                                <li>At IIS level: in the application <code>web.config</code> file</li>
                                            </ul>
                                            <div class="notices note">
                                                <p>Note that when creating an environment variable in IIS <code>web.config</code> file, all child processes created by the IIS application will inherit from this environment variables.
For example, while running the <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>&#160;agent all tasks started by the agent will inherit the proxy environment variables.</p>
                                            </div>
                                            <p>This example shows how to configure the proxy in the IIS <code>web.config</code> file:</p><pre class="xml" xml:space="preserve"><code>
&lt;configuration&gt;  &lt;system.webServer&gt;    &lt;aspNetCore processPath="dotnet" arguments="./Usercube-Server.dll" stdoutLogEnabled="false" stdoutLogFile="../Temp/stdout-server.log" hostingModel="inprocess"&gt;      &lt;environmentVariables&gt;
        <b>&lt;environmentVariable name="HTTPS_PROXY" value="proxy.contoso.com:6060"/&gt;        &lt;environmentVariable name="NO_PROXY" value=".google.com"/&gt;</b>
      &lt;/environmentVariables&gt;...
    &lt;/aspNetCore&gt;  &lt;/system.webServer&gt;&lt;/configuration&gt;
</code></pre>
                                            <h2 id="testing-the-proxy-configuration">Testing the Proxy Configuration</h2>
                                            <p>To test the proxy configuration for the dotnet environment, it is advised to use Powershell 5 or Powershell Core.</p>
                                            <p>In the following examples, you may adapt the proxy hostname/port and the URL to test.</p>
                                            <h3 id="using-powershell-5">Using Powershell 5</h3>
                                            <p>To test that a <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span> agent using a proxy server can reach the <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span> server:
Go to the <code>&lt;USERCUBE_HOME&gt;/Runtime</code> directory.</p><pre class="powershell" xml:space="preserve"><code>
$env:HTTPS_PROXY="proxy.contoso.com"
./Usercube-Invoke-Job.exe --api-url https://contoso.usercube.com/ --api-client-id Job --api-secret secret -j UnknownJob

# Given the credentials are valid, you should get an exception as follows:
# ---&gt; System.Exception: Job: UnknownJob is not found
# This exception shows that the server has been reached and that the job identifier is not known.
# The proxy is properly configured !!!
</code></pre>
                                            <div class="notices note">
                                                <p><strong>Do not use</strong> Invoke-WebRequest or Test-NetConnection to test the proxy configuration.
In Powershell 5, these tools are using a different network stack from dotnet environment and are using the OS-wide proxy settings.
They will ignore the <code>HTTPS_PROXY</code> environment variable</p>
                                            </div>
                                            <h3 id="using-powershell-core">Using Powershell Core</h3>
                                            <p>Powershell Core is based on the same network stack as dotnet environment. The proxy configuration can be tested using the Invoke-WebRequest and Test-NetConnection tools. If tests are successful using Invoke-WebRequest, they will be successful too if the same environment variables are provided to the <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span> server or agent.</p>
                                            <div class="notices note">
                                                <p>Powershell Core will only take the <code>HTTPS_PROXY</code> environment variable into account if it was created before the Powershell Core process was started.</p>
                                            </div><pre class="powershell" xml:space="preserve"><code>
# Create the environment variable in this Powershell Core process.
# This variable will not alter the proxy configuration of this process.
$env:HTTPS_PROXY="proxy.contoso.com"
# Start a child Powershell Core process which will inherit from the HTTPS_PROXY environment variable.
# This variable will alter the proxy configuration of this child process.
pwsh
Invoke-WebRequest https://contoso.usercube.com/
# The result should display an HTTP 200 response from the Usercube server.

# Go back to the parent Powershell parent process.
exit
</code></pre>
                                            <h3 id="known-errors-when-proxy-is-not-properly-configured">Known errors when proxy is not properly configured</h3>
                                            <p>When the proxy environment variables does not match the expected format, they will be <strong>silently</strong> ignored.</p>
                                            <ul>
                                                <li>If <code>HTTPS_PROXY</code> is ignored, the network stack will try to directly access public URL's without going through the proxy.</li>
                                                <li>If <code>NO_PROXY</code> is ignored, the internal traffic will be routed through the proxy.</li>
                                            </ul>
                                            <p>When testing the proxy configuration, if you get one of the following error message:</p>
                                            <ul>
                                                <li><code> No such host is known.</code>
                                                </li>
                                                <li><code>Hï¿½te inconnu</code>
                                                </li>
                                            </ul>
                                            <p>It means that the <code>HTTPS_PROXY</code> is not set or does not match the expected format. The HTTP client tries to directly resolve the public hostname instead of resolving the proxy hostname.</p>
                                            <p>Review the <code>HTTPS_PROXY</code> value, check that it does not:</p>
                                            <ul>
                                                <li>use the <code>https</code> scheme</li>
                                                <li>include trailing slashes or characters after the hostname:port</li>
                                            </ul>
                                            <h2 id="reference-documentation">Reference Documentation</h2>
                                            <ul>
                                                <li><a href="https://learn.microsoft.com/en-us/dotnet/api/system.net.http.httpclient.defaultproxy?view=net-8.0&amp;viewFallbackFrom=netcore-8.0#remarks">HttpClient.DefaultProxy</a>: reference for environment variables.</li>
                                                <li>NO_PROXY: <a href="https://stackoverflow.com/a/62663469">unofficial documentation</a> for wildcard domain exclusion</li>
                                            </ul>
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>