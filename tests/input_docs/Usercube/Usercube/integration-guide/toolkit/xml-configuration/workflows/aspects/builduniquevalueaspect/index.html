<!DOCTYPE html>
<html lang="en-us" class="js csstransforms3d _Skins_HTML5___Side_Navigation" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Home Page|Integration Guide|Toolkit for XML Configuration|XML Configuration Schema|Workflows|Aspects">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../../../../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>
              
              Build Unique Value Aspect
              </title>
        <link href="../../../../../../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <script src="../../../../../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body class="" data-url="../../../../../../integration-guide/toolkit/xml-configuration/workflows/aspects/builduniquevalueaspect/">
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="title tab bar" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../../../../index.html" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div id="mc-main-content" role="main" data-mc-content-body="True">
                                    <section id="body">
                                        <div id="body-inner">
                                            <h1>
                                                <div>
              
              Build Unique Value Aspect
              </div>
                                            </h1>
                                            <p>Computes a unique value for a given property.</p>
                                            <h2 id="examples">Examples</h2>
                                            <p>The following example generates bots' logins during their creation.</p><pre class="xml" xml:space="preserve"><code>
<b>&lt;BuildUniqueValueAspect Identifier="Directory_Bot_UniqueValue_Login" Binding="Workflow_Directory_Bot:Directory_Bot.Login" ExpressionBinding="Workflow_Directory_Bot:Directory_Bot" Expression="C#:wkf:return 'B' + string.Format(&amp;quot;{0:D5}&amp;quot;, new Random().Next(99000, 99999));" SqlCheckExpression="SELECT TOP 1 login FROM zz_directory_bot WHERE login=@VALUE" Priority="10" IterationsCount="10" SimulationExpression="C#:wkf:return &amp;quot;99999&amp;quot;;"&gt;</b>
    &lt;PointCut Activity="Directory_Bot_Create:Request" ActivityState="Action-Executed" Mode="After" /&gt;&lt;/BuildUniqueValueAspect&gt;
</code></pre>
                                            <h2 id="properties">Properties</h2>
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>Property</th>
                                                        <th>Details</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>Binding<br /><span class="requiredAttribute">required</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />Binding whose difference with <code>ExpressionBinding</code> defines the property to be computed.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Identifier<br /><span class="requiredAttribute">required</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />Unique identifier of the aspect.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Expression<br /><span class="optionalAttribute">optional</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />C# expression that computes the unique value.<br /><br /><strong>Note:</strong> the computation can be configured in SQL instead of C# via <code>SqlBuildExpression</code>. Decide whether to use either <code>Expression</code> or <code>SqlBuildExpression</code>, <u>not both</u>.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>ExpressionBinding<br /><span class="optionalAttribute">optional</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />Binding:<br />- that defines the variable type used in the potential expressions specified in the aspect;<br />- whose difference with <code>Binding</code> defines the property involved in the aspect.<br /><br /><strong>Note:</strong> required when handling the property of multi-valued objects, for example records, to make sure to modify the property in all records and not only in one.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>HistorizeBinding<br /><span class="optionalAttribute">optional</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />Binding that stores all the old values computed by the aspect.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>HistorizeSeparator<br /><span class="optionalAttribute">default value: �</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />Defines the character used as a separator in the <code>HistorizeBinding</code> property.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>IfExpression<br /><span class="optionalAttribute">optional</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />Expression that conditions the aspect execution. See the <a href="../../../../expressions/index.html" target="_parent" title="Expressions" alt="Expressions" class="MCXref xref">Expressions</a> topic for additional information.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>IterationsCount<br /><span class="optionalAttribute">default value: 0</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />Maximum number of computation attempts without finding a unique value.<br /><br /><strong>Note:</strong> a variable named <code>iteration</code> is available to use the attempt number in the expressions of the aspect and/or of the potential unicity check rules, for example to help manage homonyms. Hence, a custom variable cannot be declared with the name <code>iteration</code>.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Message_L1<br /><span class="optionalAttribute">default value: </span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />Message in language 1 (up to 16) to be displayed when the value generation failed, i.e. when <code>IterationsCount</code> is exceeded.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>OnlyIfNew<br /><span class="optionalAttribute">default value: false</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br /><code>true</code> to trigger the aspect only for the creation of new resources.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Priority<br /><span class="optionalAttribute">default value: 0</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />Int32<br /><br /><strong>Description</strong><br />Execution priority among all aspects. At a given activity state, the aspect with the highest priority will be triggered first.<br /><br /><strong>Note:</strong> the priority can be a negative value.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>SimulationExpression<br /><span class="optionalAttribute">optional</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />Expression used instead of the <code>Expression</code> parameter when previewing the workflow result before its implementation.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>SqlBuildExpression<br /><span class="optionalAttribute">optional</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />SQL command that computes the unique value.<br /><br /><strong>Note:</strong> the computation can be configured in C# instead of SQL via <code>Expression</code>. Decide whether to use either <code>SqlBuildExpression</code> or <code>Expression</code>, <u>not both</u>.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>SqlCheckExpression<br /><span class="optionalAttribute">optional</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />SQL request that checks whether the value computed with the binding/expression is unique, i.e. not yet used by another resource.<strong>Note:</strong> required if zero unicity check rules are linked to the aspect.<strong>Warning:</strong> the SQL request must be efficient because a potential timeout may block the progress of the workflow. For example, when the database's state and indexes are not well known, prefer to use views rather than the whole tables, because views store way fewer elements than tables, which makes them faster to use in a request.</p>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <h2 id="child-element-pointcut">Child Element: PointCut</h2>
                                            <p>A pointcut is a mechanism telling <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span> when to execute the linked <a href="../index.html" target="_parent" class="MCXref xref">Aspects</a>.</p>
                                            <p>The position of the pointcut is specified by an activity state and a mode (before or after).</p>
                                            <p>
                                                <img src="../../../../../../../Resources/Images/PointCut.png" alt="pointcut Schema" style="box-shadow: none;" />
                                            </p>
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>Property</th>
                                                        <th>Details</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>Activity<br /><span class="requiredAttribute">required</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />Int64<br /><br /><strong>Description</strong><br />Identifier of the activity whose specified state triggers the aspect.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>ActivityState<br /><span class="requiredAttribute">required</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />Enumeration<br /><br /><strong>Description</strong><br />Identifier of the activity state that triggers the aspect.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Mode<br /><span class="optionalAttribute">default value: 0</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />PointCutMode<br /><br /><strong>Description</strong><br />Mode defining when exactly the aspect is triggered around the specified workflow's activity state.<br /><code>0</code> - <strong>Before</strong>: the aspect will be executed on entry to the specified activity state, regardless of the transition used.<br /><code>1</code> - <strong>After</strong>: the aspect will be executed on exit from the specified activity state, regardless of the transition used.</p>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <h2 id="child-element-unicitycheckrule">Child Element: UnicityCheckRule</h2>
                                            <p>A unicity check rule ensures that the expression computed by a <code>BuildUniqueValue</code>aspect for a given property is unique, i.e. not yet used by another resource, in a given entity type.</p>
                                            <div class="notices info">
                                                <p>The comparison performed by these rules to check unicity can be configured in SQL instead of C# via the <a href="#" class="selected"><code>SqlCheckExpression</code></a> property of the aspect.</p>
                                            </div>
                                            <p>The value of the <u>source</u> binding/expression is computed based on the properties of the <u>source</u> resource which is the resource whose property we compute via the <code>BuildUniqueValue</code> aspect.</p>
                                            <p>The rule compares the return value of the <u>source</u> binding/expression with the existing values of the <u>target</u> binding/expression in the <u>target</u> entity type.</p>
                                            <p>
                                                <img src="../../../../../../../Resources/Images/Aspects_unicityCheck.png" alt="Schema: Unicity Check" style="box-shadow: none;width: 674px;height: 291px;" />
                                            </p>
                                            <blockquote>
                                                <p>For example, we need to generate an email address for any new user joining the company. We configure in a <code>BuildUniqueValue</code> aspect that users' emails are computed with <code>{firstName}.{lastName}@{EmailDomain}</code>.</p>
                                                <p>Consider a new user called John Doe. We need to link to the aspect a unicity check rule that is going to compare the email core <code>john.doe</code> with the email cores of existing resources in a given entity type. Thus <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span> can ensure that the email core is unique, and finally build the unique email address.</p>
                                            </blockquote>
                                            <p>Both source and target bindings/expressions must be consistent with the binding/expression used in the corresponding aspect which must not use a <code>SqlCheckExpression</code>.</p>
                                            <div class="notices info">
                                                <p>One <code>BuildUniqueValue</code> aspect can be linked to many unicity check rules, but should not be linked to more than one rule per target entity type.
<br /><br />The unicity check rules linked to a same aspect are combined with the AND operator. It means that the aspect's iteration goes up when at least one of the rules detects non-unicity.</p>
                                            </div>
                                            <div class="notices warning">
                                                <p>When creating or updating a unicity check rule, launch the <a href="../../../jobs/tasks/server/computecorrelationkeystask/index.html" target="_parent" title="Compute Correlation Keys Task" alt="Compute Correlation Keys Task" class="MCXref xref">
              
              Compute Correlation Keys Task
              </a>before applying the role model and launching workflows.
<br /><br /><strong>For information:</strong> <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span> needs to store the correlation keys linked to the expressions defined in the unicity check rule, such as the return value, the entity type, etc. That's why the task mentioned above must be launched before launching any workflow using a unicity check rule.</p>
                                            </div>
                                            <h3 id="examples-1">Examples</h3>
                                            <h4 id="basic-example">Basic example</h4>
                                            <p>The following example checks the unicity of the login of a new user.</p>
                                            <blockquote>
                                                <p>In order to be able to write the source and target bindings/expressions of the unicity check rule, you must understand the binding/expression of the corresponding <code>BuildUniqueValue</code> aspect:</p><pre class="xml" xml:space="preserve"><code>
&lt;BuildUniqueValueAspect Identifier="Directory_UserRecord_UniqueValue_Login" Binding="Workflow_Directory_User:Directory_User.Records.Login" ExpressionBinding="Workflow_Directory_User:Directory_User.Records" Expression="C#:record:return (record.UserType?.LoginPrefix ?? &amp;quot;U&amp;quot;) + record.UserIdentifier;" IterationsCount="10" Priority="70" &gt;  &lt;PointCut ... /&gt;&lt;/ BuildUniqueValueAspect &gt;
</code></pre>
                                            </blockquote>
                                            <p>We want to check the unicity of the new user's login, compared with the logins of existing users:</p><pre class="xml" xml:space="preserve"><code>
&lt;UnicityCheck Aspect="Directory_UserRecord_UniqueValue_Login" TargetEntityType="Directory_UserRecord" TargetBinding="Login" /&gt;
</code></pre>
                                            <div class="notices note">
                                                <p>Here the source binding and expression are those from the aspect.</p>
                                            </div>
                                            <h4 id="multiple-unicity-checks">Multiple unicity checks</h4>
                                            <p>With the same aspect as the previous example, we might want to compare the login of the new user with the list of reserved logins too:</p><pre class="xml" xml:space="preserve"><code>
&lt;UnicityCheck Aspect="Directory_UserRecord_UniqueValue_Login" TargetEntityType="Directory_UserRecord" TargetBinding="Login" /&gt;&lt;UnicityCheck Aspect="Directory_UserRecord_UniqueValue_Login" TargetEntityType="Directory_ReservedLogin" TargetBinding="Value" /&gt;
</code></pre>
                                            <h4 id="sophisticated-example">Sophisticated example</h4>
                                            <p>The following example checks the unicity of the email address of a new user.</p>
                                            <blockquote>
                                                <p>In order to be able to write the source and target bindings/expressions of the unicity check rule, you must understand the binding/expression of the corresponding <code>BuildUniqueValue</code> aspect:</p><pre class="xml" xml:space="preserve"><code>
&lt;BuildUniqueValueAspect Identifier="Directory_UserRecord_UniqueValue_Email" Binding="Workflow_Directory_User:Directory_User.Records.Email" ExpressionBinding="Workflow_Directory_User:Directory_User.Records" Priority="80"

<em><span class="optionalAttribute">// We want an email address such as {firstName}.{lastName}@{EmailDomain}.</span></em>

Expression="C#:record:var firstName = record.FirstName.Simplify()?.ToLowerInvariant();
var lastName = record.LastName.Simplify()?.ToLowerInvariant();
if (string.IsNullOrEmpty(firstName) || string.IsNullOrEmpty(lastName))
{
  <em>// Missing data</em>
  return null;
}

var result = firstName + &amp;quot;.&amp;quot; + lastName;

<em>// If the email core, i.e. {firstName}.{lastName}, is already used, then we try with {firstName}.{lastName}2, etc.</em>
if (iteration &amp;gt; 0)
{
  result += iteration.ToString();
}

result = result + '@' + record.Subsidiary?.EmailDomain;
return result;" IterationsCount="10" /&gt;
</code></pre>
                                            </blockquote>
                                            <p>We want to include in the unicity check only the email's core <code>firstName.lastName</code> without the <code>@EmailDomain</code> part. This is why the source expression starts like the aspect's expression but does not add the domain part, and the target expression removes the domain part from existing values:</p><pre class="xml" xml:space="preserve"><code>
&lt;UnicityCheck Aspect="Directory_UserRecord_UniqueValue_Email"

    SourceBinding="Workflow_Directory_User:Directory_User.Records"
    
    <em>// The source expression is similar to the one from the aspect, but we check the unicity of the email core only, not the whole email address.</em>

    SourceExpression="C#:record:var firstName = record.FirstName.Simplify()?.ToLowerInvariant();
var lastName = record.LastName.Simplify()?.ToLowerInvariant();
if (string.IsNullOrEmpty(firstName) || string.IsNullOrEmpty(lastName))
{
    <em>// Missing data</em>
    return null;
}

var result = firstName + &amp;quot;.&amp;quot; + lastName;
if (iteration &amp;gt; 0)
{
    result += iteration.ToString();
}

return result;"

    TargetEntityType="Directory_UserRecord"
    TargetExpression="C#:record:
if(string.IsNullOrEmpty(record.Email))
{
    return null;
}

var result = record.Email;

<em>// Delete the domain to keep only the email core</em>
var index = result.IndexOf('@');
if(index &amp;gt;= 0)
{
    result = result.Substring(0, index);
}
return result;" /&gt;
</code></pre>
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>Property</th>
                                                        <th>Details</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>SourceBinding<br /><span class="optionalAttribute">optional</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />Int64<br /><br /><strong>Description</strong><br />Binding property (from the source entity type specified in the corresponding workflow) whose value is to be compared with the existing values of the target binding/expression.<br /><br /><strong>Note:</strong> when not specified, the unicity check rule uses the binding from the aspect.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>SourceExpression<br /><span class="optionalAttribute">optional</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />Binding expression (based on properties from the source entity type specified in the corresponding workflow) whose value is to be compared with the existing values of the target binding/expression. See the <a href="../../../../expressions/index.html" target="_parent" title="Expressions" alt="Expressions" class="MCXref xref">Expressions</a> topic for additional information.<br /><br /><strong>Note:</strong> when not specified, the unicity check rule uses the expression from the aspect.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>TargetBinding<br /><span class="optionalAttribute">optional</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />Int64<br /><br /><strong>Description</strong><br />Binding property (from the target entity type) whose values corresponding to existing resources are to be compared with the value of the source binding/expression.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>TargetEntityType<br /><span class="requiredAttribute">required</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />Int64<br /><br /><strong>Description</strong><br />Identifier of the entity type for which the rule checks the property's unicity.</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>TargetExpression<br /><span class="optionalAttribute">optional</span></td>
                                                        <td>
                                                            <p><strong>Type</strong>
                                                                <br />String<br /><br /><strong>Description</strong><br />Binding expression (based on properties from the target entity type) whose values corresponding to existing resources are to be compared with the value of the source binding/expression. See the <a href="../../../../expressions/index.html" target="_parent" title="Expressions" alt="Expressions" class="MCXref xref">Expressions</a> topic for additional information.<br /></p>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>