<!DOCTYPE html>
<html lang="en-us" class="js csstransforms3d _Skins_HTML5___Side_Navigation" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Home Page|Integration Guide|Identity Management|Identity Lifecycle: Joiners, Movers and Leavers">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>
              
              Position Change via Records
              </title>
        <link href="../../../../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <script src="../../../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body class="" data-url="../../../../integration-guide/identity-management/joiners-movers-leavers/position-change/">
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="title tab bar" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../../index.html" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div id="mc-main-content" role="main" data-mc-content-body="True">
                                    <section id="body">
                                        <div id="body-inner">
                                            <h1>
                                                <div>
              
              Position Change via Records
              </div>
                                            </h1>
                                            <p>Identities' Joiners, Movers and Leavers (JML) process can be made easy by using the adequate model: records and contexts.</p>
                                            <p>In <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>, position changes are made through workflows or through synchronization to the HR system.</p>
                                            <h2 id="overview">Overview</h2>
                                            <p>The entitlements of a user must be updated with the user's position changes: the entitlements needed for the previous position are removed, and the entitlements needed for the next position are added. This is essential to prevent users from cumulating entitlements when moving.</p>
                                            <p>Just like onboarding, the entitlement fulfillment can be performed either by using <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>'s suggestions for the needed entitlements and adjusting them, or trusting <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span> with an automated fulfillment.</p>
                                            <p><span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>'s calculations for entitlement assignments rely on heuristics, through identities' key properties called <a href="../../../../introduction-guide/overview/entitlement-management/index.html" target="_parent" class="MCXref xref">
              
              Entitlement Management
              </a>.</p>
                                            <blockquote>
                                                <p>For example, consider an entity type modeling identities with their job title, department and location.</p>
                                                <p>Then a user working as a accountant in Paris will receive different entitlements from another user working as a marketing specialist in Scranton.</p>
                                            </blockquote>
                                            <p>Hence entitlement assignment is usually based on identities' positions.</p>
                                            <p>Within the company, an identity can hold one or several positions, sometimes several positions simultaneously.</p>
                                            <h2 id="a-model-for-identity-changes">A Model for Identity Changes</h2>
                                            <p>Any change in an identity's lifecycle, such as a position change, usually entails a change in a given set of properties simultaneously.</p>
                                            <blockquote>
                                                <p>For example, a position change can typically trigger a change at least in the job title and location, together with the position start and end dates.</p>
                                            </blockquote>
                                            <p>It seems natural to model identities by splitting their properties into three entities: one for users' personal data, one for their contract(s) and one for their position(s):</p>
                                            <p style="text-align: center;">
                                                <img src="../../../../../Resources/Images/RecordsOrigin_firstModel.png" alt="Records Origin - Three-Entity Model" style="box-shadow: none;width: 777px;height: 511px;" />
                                            </p>
                                            <p>A user can have several positions over time, even simultaneously. A user's contract can change over time too. Even personal data is subject to change. This is why we can have several sets of personal data (and/or several contracts and/or several positions) for a single user, and also why the <code>User</code> entity is meant to contain only users' unique identifiers.</p>
                                            <blockquote>
                                                <p>For example, in personal data a marriage can imply a name change, a user can start with a fixed-term contract and change to a permanent one, and position change is obvious.</p>
                                            </blockquote>
                                            <div class="notices note">
                                                <p>Even without allowing simultaneous positions, contracts or personal data sets, this model helps anticipate upcoming changes.</p>
                                            </div>
                                            <h3 id="contexts">Contexts</h3>
                                            <p>The model is supposed to facilitate the <a href="../../../provisioning/index.html" target="_parent" title="Provisioning" alt="Provisioning" class="MCXref xref">Provisioning</a> provisioning of user data and entitlements, yet this first model does not meet all expectations. In case of multiple personal data sets for a single user over time, or multiple contracts, or multiple positions, which values should be used to apply the rules of the role model? How to combine all start and end dates to make sure that all rules are applied based on the right input? These issues imply complex C# expressions in provisioning rules.</p>
                                            <blockquote>
                                                <p><a name="expression-examples"></a>For example, let's write a C# expression to compute users' display names based only on their first and last names. To make sure that display names are computed using valid input, we write the following:</p><pre class="Csharp" xml:space="preserve"><code>
C#:user:return user.PersonalDatas.Where(personalData =&gt; personalData.Start &lt; DateTime.Now &amp;&amp; personalData.End &gt; DateTime.Now).Select(personalData =&gt; personalData.FirstName + ' ' + personalData.LastName).FirstOrDefault();
</code></pre>
                                                <p>Now a more complex example: let's write a C# expression to compute users' <u>departments</u> based on their organization's display names, but also their employee identifiers in parenthesis:</p><pre class="Csharp" xml:space="preserve"><code>
C#:user:return user.Positions.Where(position =&gt; position.Start &lt; DateTime.Now &amp;&amp; position.End &gt; DateTime.Now).Select(position =&gt; position.Organization.DisplayName).FirstOrDefault() + " (" + user.PersonalDatas.Where(personalData =&gt; personalData.Start &lt; DateTime.Now &amp;&amp; personalData.End &gt; DateTime.Now).Select(personalData =&gt; personalData.EmployeeId).FirstOrDefault() + ")";
</code></pre>
                                            </blockquote>
                                            <p>To simplify the expressions, the model needs to be "flattened" in order to provide all the data of a given user, valid at a given date. Hence users must be modeled by a set datasheets generated by <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>, where all values in one datasheet are valid on a given time period.</p>
                                            <blockquote>
                                                <p>For example, consider the following situation: Mark Barn is a user who has, at day D0, a given set of personal data, a given contract and a given position. At day D1, his contract changes from fixed-term to permanent. At day D2, he starts an additional position. The two positions overlap from day D2 to day D3 when the first position ends.

</p>
                                                <p style="text-align: center;">
                                                    <img src="../../../../../Resources/Images/RecordsOrigin_userExample.png" alt="User Example" style="box-shadow: none;width: 780px;height: 398px;" />
                                                </p>
Over time, the three entities are as follows:

<p style="text-align: center;"><img src="../../../../../Resources/Images/RecordsOrigin_timelines.png" alt="Example - Timelines" style="box-shadow: none;width: 782px;height: 418px;" /></p>
From this, <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>&#160;is able to combine the start and end dates of all entities at all times to generate the following datasheets, named contexts:

<p style="text-align: center;"><img src="../../../../../Resources/Images/RecordsOrigin_contexts.png" alt="Example - Contexts" style="box-shadow: none;width: 772px;height: 460px;" /></p></blockquote>
                                            <p>Contexts are the result of the combination of all entities (personal data, contract and position) so that all values contained in a given context are valid on a given period of time.</p>
                                            <div class="notices info">
                                                <p>Users can be modeled by up to n*n*n contexts, and even more when elements overlap (positions in this example).</p>
                                            </div>
                                            <p>The complexity that comes from the combination of all start and end dates is tackled by <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>'s engine when it generates users' contexts. As the start and end dates of each value are pre-computed by <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>, this user model highly simplifies provisioning rules.</p>
                                            <blockquote>
                                                <p>The C# expressions from the previous example can be written, for the same result, as the following, first for users' display names, then departments:</p><pre class="Csharp" xml:space="preserve"><code>
C#:record:return record.FirstName + ' ' + record.LastName;
</code></pre><pre class="Csharp" xml:space="preserve"><code>
C#:record:return record.Organization.DisplayName + " (" + record.EmployeeId + ")";
</code></pre>
                                            </blockquote>
                                            <h3 id="records">Records</h3>
                                            <p>The final step to a viable model is to find a way to store optimally this context model in the database, in order to be able to perform fast requests. Hence, the final model gathers all entities (personal data, contracts and positions), including their respective start and end dates, into a single entity named records, where a context is a record instance:</p>
                                            <p style="text-align: center;">
                                                <img src="../../../../../Resources/Images/RecordsOrigin_thirdModel.png" alt="Records Origin - Final Model" style="box-shadow: none;width: 798px;height: 225px;" />
                                            </p>
                                            <p>While there are as many contexts for a user as the number of changes in the user's datasheet, there are only as many records as needed to store each value at least once.</p>
                                            <blockquote>
                                                <p>With the example used for the explanation of contexts with <code>PD</code>, <code>C1</code>, <code>C2</code>, <code>P1</code> and <code>P2</code>, we generate 5 contexts but store only 2 records: <code>{PD; C1; P1}</code> and <code>{PD; C2; P2}</code>.</p>
                                                <p>From these 2 records, we can rebuild the 5 contexts.</p>
                                            </blockquote>
                                            <div class="notices note">
                                                <p>Contexts can be considered as the conversion tool between the two user models.</p>
                                            </div>
                                            <p>This way, the model stores only Max(n) records instead of n*n*n.</p>
                                            <p>Plus, <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>&#160;does not need to archive old data, because records and contexts are used only to simplify the application of provisioning rules. As only valid values are provisioned, there is no need to keep track.</p>
                                            <div class="notices info">
                                                <p>This means that a change to be <u>effective immediately</u> will not trigger the creation of a new record nor a new context. The record containing the old data will simply be updated.
<br /><br />A change to be effective in future can trigger the creation of a new record.</p>
                                            </div>
                                            <h3 id="configuration">Configuration</h3>
                                            <p>This identity model can be implemented by configuring a <a href="../../../toolkit/xml-configuration/provisioning/contextrule/index.html" target="_parent" class="MCXref xref">
              
              Context Rule
              </a> and <a href="../../../toolkit/xml-configuration/provisioning/recordsection/index.html" target="_parent" title="RecordSection" alt="RecordSection" class="MCXref xref">
              
              Record Section
              </a>:</p><pre class="xml" xml:space="preserve"><code>
&lt;ContextRule Identifier="Directory_User" DisplayName_L1="Directory_User" Policy="Default" SourceEntityType="Directory_User" ResourcesBinding="Records" ResourcesStartExpression="C#:record:return record.StartDate ?? record.PositionStartDate ?? record.ContractStartDate;" ResourcesEndExpression="C#:record:return record.EndDate ?? record.PositionEndDate ?? record.ContractEndDate;" ExcludeExpression="C#:record:return record.IsDraft.GetValueOrDefault();" RiskFactorType="Max"
    B0="Directory_UserRecord:Organization"
    B1="Directory_UserRecord:Title"
    B2="Directory_UserRecord:Site"
    B3="Directory_UserRecord:Site.Region.Country"
    B4="Directory_UserRecord:UserType.Category"
    B5="Directory_UserRecord:Organization.Type"
    B6="Directory_UserRecord:Subsidiary"
    B7="Directory_UserRecord:ExternalCompany"
/&gt;

<em>Personal data section (default section):</em>
&lt;RecordSection Identifier="Directory_UserRecord_Default" DisplayName_L1="User Properties" SourceEntityType="Directory_User" ResourceEntityType="Directory_UserRecord" StartProperty="StartDate" EndProperty="EndDate" InstanceKeyExpression="C#:record:return record.StartDate.HasValue ? record.StartDate.Value.ToString("yyyyMMdd") : string.Empty;"&gt;&lt;/RecordSection&gt;

<em>Contract section:</em>
&lt;RecordSection Identifier="Directory_UserRecord_Contract" DisplayName_L1="Contract Properties" SourceEntityType="Directory_User" ResourceEntityType="Directory_UserRecord" StartProperty="ContractStartDate" EndProperty="ContractEndDate" IsDefaultBoundariesSection="true" InstanceKeyExpression="C#:record:return record.ContractIdentifier;"&gt;  &lt;Property Property="UserType"/&gt;  &lt;Property Property="ExternalCompany"/&gt;  &lt;Property Property="Subsidiary"/&gt;&lt;/RecordSection&gt;

<em>Position section:</em>
&lt;RecordSection Identifier="Directory_UserRecord_Position" DisplayName_L1="Position Properties" SourceEntityType="Directory_User" ResourceEntityType="Directory_UserRecord" StartProperty="PositionStartDate" EndProperty="PositionEndDate" InstanceKeyExpression="C#:record:return record.PositionIdentifier;"&gt;  &lt;Property Property="PositionIdentifier" /&gt;  &lt;Property Property="JobTitle" /&gt;  &lt;Property Property="OfficeNumber" /&gt;  &lt;Property Property="Organization" /&gt;  &lt;Property Property="Site"/&gt;  &lt;Property Property="Title" /&gt;  &lt;Property Property="Office" /&gt;  &lt;Property Property="Manager" /&gt;  &lt;Property Property="IGAManager" /&gt;  &lt;Property Property="EffectiveIGAManager" /&gt;  &lt;Property Property="IsMainPosition" /&gt;&lt;/RecordSection&gt;
</code></pre>
                                            <h2 id="position-change">Position Change</h2>
                                            <p>The position change process for an existing worker is materialized by the assignment/update/removal of a record to/from an identity. This assignment/update/removal triggers the fulfillment of the entitlements required by the user based on the properties of a valid record.</p>
                                            <div class="notices info">
                                                <p>When several contexts are valid at the same time for a given identity, conflicts can arise during entitlement assignment. They are solved by <span class="mc-variable IdentityManager.Product_Stort_Name variable">Identity Manager</span>'s engine that establishes a priority between valid contexts.</p>
                                            </div>
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>