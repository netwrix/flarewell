<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="_Skins_Netwrix_Website" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="[%=System.LinkedTitle%]|Application Manager|[%=System.LinkedTitle%]|Troubleshooting">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>Troubleshooting Group Policy Replication Problems</title>
        <link href="../../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <script src="../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="title tab bar" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../Overview.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div id="mc-main-content" role="main" data-mc-content-body="True">
                                    <h1>Troubleshooting Group Policy Replication Problems</h1>
                                    <p>First, we suggest that if your DCs are 2008 R2 or 2012, that you first apply this patch and Registry setting to ALL 2008 R2 and/or 2012 domain controllers. (Not needed for 2012 R2). There is a known problem on DCs where they hold files open after you edit. So edits appear to work, until you close and reopen the GPO and find out that they aren't applying at all. Or replication appears to work, but some machines pick up the settings, and others do not. That's because the same DATA isn't replicated to all DCs properly. Therefore, before doing anything, ensure this is applied / apply this KB to apply to all your DCs:</p>
                                    <p><a title="Windows Support - File Not Replicated When Locked in Windows Server" rel="noopener noreferrer" href="https://support.microsoft.com/en-us/kb/2791372" target="_blank">https://support.microsoft.com/en-us/kb/2791372</a>
                                    </p>
                                    <p>Then retry the <span class="mc-variable PolicyPak.Product_Long_Name variable">Netwrix Endpoint Policy Manager (formerly PolicyPak)</span> operation.</p>
                                    <p class="Note-1" data-mc-autonum="&lt;b&gt;NOTE: &lt;/b&gt;"><span class="autonumber"><span class="Note"><b>NOTE: </b></span></span>Troubleshooting Group Policy Replication problems is beyond the normal <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> tech support, since it's not specifically a <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> issue. If you have a replication problem, here is our suggestion to help you overcome replication problems.</p>
                                    <p class="Caution" data-mc-autonum="&lt;span style=&quot;color: #da0000;&quot; class=&quot;mcFormatColor&quot;&gt;&lt;b&gt;CAUTION: &lt;/b&gt;&lt;/span&gt;"><span class="autonumber"><span class="Caution"><span style="color: #da0000;" class="mcFormatColor"><b>CAUTION: </b></span></span></span>These tips are USE AT YOUR OWN RISK, since Directory Services troubleshooting is beyond the scope of the <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> troubleshooting support team.</p>
                                    <p>Symptoms: Everything might be running smoothly until you get inconsistent results upon clients when your <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> directives embedded within GPOs. Some of your workstations are receiving the GPOs others aren't.</p>
                                    <p>While we don't want to completely rule out <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span>'s engine, it's more likely an Active Directory replication problem.</p>
                                    <p>If you have more than one domain controller in your domain, specific clients use DC based upon site membership. If you have multiple DCs within each site, then clients pick a DC by "weight" where normally, all DCs are "weighted equally."</p>
                                    <p>And, it's also possible that your clients may even utilize a DC located at another site!</p>
                                    <p>Therefore, if your DC's aren't replicating correctly, than the SYSVOL directories hosted on them may not have precisely mirrored data that they should have. This means that your workstations will get different results, depending on which DC it is directed to.</p>
                                    <p>Here are some great troubleshooting tips however.</p>
                                    <ul>
                                        <li>You should always begin by running gpupdate from the workstation that is experiencing inconsistent results. If you get a failure notice such as the one below, than there is a GPO delivery problem at large.</li>
                                    </ul>
                                    <p>
                                        <img src="../../../Resources/Images/Troubleshooting/ApplicationSettings/3_1_troubleshooting-grou-policy-replication2.png" alt="" />
                                    </p>
                                    <p class="Note-1" data-mc-autonum="&lt;b&gt;NOTE: &lt;/b&gt;"><span class="autonumber"><span class="Note"><b>NOTE: </b></span></span>
                                        <br /> It's very possible the first GPO to express an error one that contains <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> directives. But it's equally likely that it's another GPO as well.</p>
                                    <ul>
                                        <li>At the most basic level, a DC should have two shared folders by default, NETLOGON and SYSVOL. If you do not have these two folders, you have an AD problem and GPOs will not be delivered from it properly.</li>
                                    </ul>
                                    <p>
                                        <img src="../../../Resources/Images/Troubleshooting/ApplicationSettings/3_2_troubleshooting-grou-policy-replication1.png" alt="" />
                                    </p>
                                    <ul>
                                        <li>DCDIAG.exe – The DCDiag (Domain Controller Diagnostic) tool will analyse the state of the domain controllers and services in an Active Directory forest. DCDiag is a very good general-purpose testing tool for checking the health of the AD infrastructure. The available tests include replication errors, domain controller connectivity, permissions, proper roles, and connectivity, and other general AD health tests. Click HERE for more information about this command.</li>
                                        <li>You can force replication <a title="Blog - AD – Force SYSVOL and AD replication" rel="noopener noreferrer" href="https://maddog2050.wordpress.com/2014/09/15/ad-force-sysvol-and-ad-replication/" target="_blank">with this script</a>. Note that it requires a download from the Windows AD Support Tools first.</li>
                                        <li>GPOTOOL.exe – This powerful CLI tool checks the consistency of Group Policy Objects (GPOs) between the Sysvol- and Active Directory based portions of GPOs checks GPO replication searches GPOs targets specific domain controllers (DCs) to allow testing of specific DC Group Policy status displays GPO information. Type GPOTOOL&gt;FileName.txt which will save the command output to a log file name of your choosing. Take a recent example of how this tool was used in the case of a <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> client. A review of the logs showed that both <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> and Non <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> GPOs were having issues. This confirmed that the problem was beyond the scope of just <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span>. Further review of the log file showed that there was a version mismatch (52 versus 54) of the SYSVOL folders which mean that they weren't replicating correctly:"Error: Version mismatch on SERVER1.FABRIKAM.COM, DS=54, sysvol=52"An even greater error was then found showing that the SYSVOL piece of the GPO wasn't even there:Sysvol version: not found</li>
                                        <li>DFSDIAG.exe – This tool checks the domain controller and name server configurations of your AD structure. Dfsdiag /testDCs is especially relevant.</li>
                                        <li>Using the troubleshooting tools above, if there is a replication problem, you should be able to determine which DC or DC's are the problem. Once this is determined you will have to rebuild the system volume (SYSVOL) on these designated servers. If you have more than one DC at a site, an easy way to do this is to simply demote the problem DC by running DCPROMO – reboot the server – and then run DCPROMO and reboot once more. For those who only have one DC residing at a site, or those who are comfortable making registry edits, you can use the Burflags registry entry to rebuild the SYSVOL. Know that demoting the only DC residing on a site may (and I mean may) require you to rejoin the clients to the domain again.</li>
                                    </ul>
                                    <p><a title="Blog - SYSVOL and Group Policy out of Sync on Server using DFSR" rel="noopener noreferrer" href="http://jackstromberg.com/2014/07/sysvol-and-group-policy-out-of-sync-on-server-2012-r2-dcs-using-dfsr/" target="_blank">Here is a decent walkthru</a> to help troubleshoot and repair replication issues.</p>
                                    <h2>How to call Microsoft for help.</h2>
                                    <p>If you are still unable to solve your replication and GPO delivery problem, then you may need to contact Microsoft Professional Support. They charge on a per incident basis and tickets must be initiated online only as they do not accept phone calls any longer to create a ticket. They can be reached at <a title="Microsoft Support" rel="noopener noreferrer" href="http://support.microsoft.com/" target="_blank">http://support.microsoft.com/</a></p>
                                    <p>You may also refer to these other articles as well.</p>
                                    <p><a title="Microsoft Docs: Active Directory and Sysvol Are Unsynchronized" rel="noopener noreferrer" href="http://technet.microsoft.com/en-us/library/cc978394.aspx" target="_blank">http://technet.microsoft.com/en-us/library/cc978394.aspx</a>
                                    </p>
                                    <p><a title="Microsoft Docs: Restoring and Rebuilding SYSVOL" rel="noopener noreferrer" href="http://technet.microsoft.com/en-us/library/cc816596(v=ws.10).aspx" target="_blank">http://technet.microsoft.com/en-us/library/cc816596(v=ws.10).aspx</a>
                                    </p>
                                    <p><a title="Microsoft Support: How to force a synch for DFSR-replicated SYSVOL" rel="noopener noreferrer" href="http://support.microsoft.com/kb/2218556" target="_blank">http://support.microsoft.com/kb/2218556</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>