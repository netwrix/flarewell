<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="_Skins_Netwrix_Website" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="[%=System.LinkedTitle%]|Getting Started with Cloud|[%=System.LinkedTitle%]|Client Tips, Tricks and FAQs">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>How to install and configure the PPC Client for a Non-Persistent VDI Image in VMware Horizon</title>
        <link href="../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <script src="../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="title tab bar" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../Overview.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div id="mc-main-content" role="main" data-mc-content-body="True">
                                    <h1>How to install and configure the PPC Client for a Non-Persistent VDI Image in VMware Horizon</h1>
                                    <p>The end goal is to install the <span class="mc-variable PolicyPak.Product_Long_Name variable">Netwrix Endpoint Policy Manager (formerly PolicyPak)</span> Cloud (PPC) Client in a non-registered state on the Gold image, then unregister the PPC client on any provisioned VDIs at shutdown before re-provisioning. Below is an example using VMware Horizon 7, though the same process should work for other VDI Solutions as well.</p>
                                    <p class="Step-Reset" data-mc-autonum="&lt;b&gt;Step 1 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 1 – </b></span></span>Boot up the Gold Image VM to the OS screen and login with an account that has local Administrator privileges.</p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 2 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 2 – </b></span></span>Create a folder called <b>PPC Client</b> under the root of the C: drive on the Gold Image VM.</p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 3 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 3 – </b></span></span>Download the required <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> Cloud Client MSI package (version 20.5.2449.838 or higher) to the Gold Image Desktop, and save it under the <code>C:\PPC Client</code> folder on the Gold Image VM.</p>
                                    <p><span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> Cloud Client version 20.5.2449.838 and higher can be found within your PPC Portal on the following page <a href="https://cloud.policypak.com/ManageCustomer/UserList" target="_blank" title="Cloud Client Version" alt="Cloud Client Version">https://cloud.policypak.com/ManageCustomer/UserList</a> under the Downloads section, by clicking on the <b>Download other versions</b> link at the bottom of the page.</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/Cloud/Integration/555_1_image-20200603123515-1.png" width="744" />
                                    </p>
                                    <p style="text-align: center;">
                                        <img alt="" src="../../Resources/Images/Cloud/Integration/555_3_image-20200603094325-1_1231x309.png" style="width: 1231;height: 309;" />
                                    </p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 4 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 4 – </b></span></span>On the Gold Image VM, while logged in as a local administrator, install the <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> Cloud Client MSI that you copied under "<code>C:\PPC Client</code>", (double-click MSI to install, etc.)</p>
                                    <p>If you would like all VDIs created from this Master Image to automatically join one or more computer groups, you should install the PPC Client using the command line instead, for example:</p>
                                    <p><code>msiexec /i "PolicyPak Cloud Client for[Customer name].msi" JOINTOKEN="AZAEllLPLTY9XKUA3CYO+ths="</code>
                                    </p>
                                    <p>The JOINTOKEN&#160;value is specific to each environment, the value used above is provided as an example only.&#160;For more information on using JOINTOKEN to automatically assign computers to computer groups in PPC please see this video: <a href="../Video/Cloud/JoinToken.html" target="_blank" title="Endpoint Policy Manager Cloud: Automatically Join Groups with JOINTOKEN" alt="Endpoint Policy Manager Cloud: Automatically Join Groups with JOINTOKEN" class="MCXref xref">Endpoint Policy Manager Cloud: Automatically Join Groups with JOINTOKEN</a></p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 5 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 5 – </b></span></span>Next, create an empty text file named <code>logoff.bat</code> under the same folder where we saved the PPC Client MSI earlier (<code>C:\PPC Client</code>). Edit <code>logoff.bat</code> using notepad and add the line below:</p>
                                    <div class="codeSnippet">
                                        <div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>PPCloud /sysprep</code></pre>
                                        </div>
                                    </div>
                                    <p class="Note-1" data-mc-autonum="&lt;b&gt;NOTE: &lt;/b&gt;"><span class="autonumber"><span class="Note"><b>NOTE: </b></span></span>&#160;</p>
                                    <ol>
                                        <li value="1">
                                            <p>	If using JOINTOKEN then you must also specify the JOINTOKEN value for the PPCloud /sysprep command above.&#160;</p>
                                            <p>For example: <code>PPCloud /sysprep /jointoken:AZAEllLPLTY9XKUA3CYO+ths=&#160;</code></p>
                                        </li>
                                        <li value="2">
                                            <p>	When testing using Logoff, remember to restart the <span style="font-weight: bold;" class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span><b> Cloud Clien</b>t service to have it register with the PPC portal again if needed.	</p>
                                        </li>
                                        <li value="3">
                                            <p> PPCLOUD /SYSPREP requires local administrator rights. You need to use <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> Least Privilege Manager to also create a rule to allow PPCloud /SYSPREP to run elevated if the user logging off is not an Administrator of the computer. If you need help with creating this LPM policy please contact support.</p>
                                        </li>
                                    </ol>
                                    <p style="text-align: center;">
                                        <img alt="" height="121" src="../../Resources/Images/Cloud/Integration/555_4_image-20230130144125-1.png" width="447" />
                                    </p>
                                    <p>The <b>ppcloud /sysprep</b> switch was intended to be used on the golden image. It can be used only after the PPCloud Client is installed. There's no need to use the full path, and you can run <b>ppcloud /sysprep</b> from the Command Prompt, or PowerShell. </p>
                                    <p>This unregisters the computer (no record on PPC portal, no license consumed, etc.), removes all the policies, and stops the <span style="font-weight: bold;" class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span><b> Cloud Client</b> service. The machine will be registered with the <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> Cloud portal after a reboot (i.e. after the image is deployed as a VDI). You can use it regardless of whether Microsoft's sysprep tool is involved or not.	&#160;</p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 6 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 6 – </b></span></span>Run <code>GPEDIT.MSC</code> and add an entry under <b>User Configuration</b> &gt; <b>Windows Settings</b> &gt; <b>Scripts (Logon/Logoff)</b> under <b>Logoff</b> that points to the <code>logoff.bat</code> file you previously created, then click <b>OK</b> to save the settings.</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/Cloud/Integration/555_5_image-20200603123515-3.png" width="656" />
                                    </p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 7 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 7 – </b></span></span>Shutdown the Gold Image VM.</p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 8 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 8 – </b></span></span>Take a snapshot to be used for new VDIs, then import your updated Gold Image into your VDI solution (update the Desktop Pool settings to use the new snapshot etc.).</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/Cloud/Integration/555_7_image-20200603123515-4.png" width="363" />
                                    </p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/Cloud/Integration/555_9_image-20200603123515-5.png" width="721" />
                                    </p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 9 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 9 – </b></span></span>Deploy two VDIs, then check in your PPC portal to ensure the newly created VDIs are registered successfully and have different Unique IDs. The VDIs by default will show up in the <b>All</b> computer group. Take note of the Unique IDs for these VDIs (screenshot etc.). You can use the <b>Columns</b> button to change which columns are visible so you can see the <b>Unique ID</b> column.</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/Cloud/Integration/555_11_image-20200603123515-6.png" width="631" />
                                    </p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 10 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 10 – </b></span></span>Log into both VDIs using the VMware Horizon Client, wait for the OS to load completely, then logoff or shutdown&#160;both VDIs. Within the PPC portal you should see the two machines disappear almost immediately when the logoff task runs on each machine.</p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 11 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 11 – </b></span></span>Wait for the two VDIs to be deleted and re-provisioned, then check in your PPC portal to see if both of the VDIs received new Unique IDs. If  they did, then the process was successful.</p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 12 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 12 – </b></span></span>If instead you see duplicate machine names similar to the screenshot below then the process failed. Revisit the steps above to see if anything was missed. If after verifying all steps you find that this process still did not work for you please contact support for further assistance.</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/Cloud/Integration/555_13_image-20200603123515-7_950x260.png" style="width: 950;height: 260;" />
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>