<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="_Skins_Netwrix_Website" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="[%=System.LinkedTitle%]|Getting Started with MDM|[%=System.LinkedTitle%]|ILT (with Scripts)">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>Use PP MDM to determine the Azure AAD Group Membership for User or Computers</title>
        <link href="../../../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <script src="../../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="title tab bar" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../Overview.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div id="mc-main-content" role="main" data-mc-content-body="True">
                                    <h1>Use PP MDM to determine the Azure AAD Group Membership for User or Computers</h1>
                                    <p>If you want to know which GROUPS your Users or Computers are in within Azure AD, then use <span class="mc-variable PolicyPak.Product_Long_Name variable">Netwrix Endpoint Policy Manager (formerly PolicyPak)</span> and these scripts with your MDM service like Intune, Workspace ONE or MobileIron.. Then after that, you can use Item Level Targeting to check group membership and trigger actions and policies.</p>
                                    <p><iframe width="1700" height="956" src="https://www.youtube.com/embed/w5HXpv4F4DY" title="Endpoint Policy Manager Scripts: Use PP MDM to determine the Azure AAD Group Membership for User or Computers" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="1"></iframe>
                                    </p>
                                    <p>Hi. This is Jeremy Moskowitz. This is part three of how to use <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> Scripts to query Azure AD to then do interesting things like apply Group Policy Preferences or <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> items depending on if a user or a computer is a member of an Azure AD group.</p>
                                    <p>In this video, we're going to assume that you have nothing but MDM. This is the <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> MDM solution, and you don't have <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> Group Policy and you don't have <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> Cloud. You've only got <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> MDM.</p>
                                    <p>Now if you only have <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> MDM, we still recommend that you do what I showed you in the first video which is to do and in fact use Group Policy as a small scale test before doing what you're about to do here.</p>
                                    <p>So in our small scale test we set up the "Install AAD module," the "Get Computer Groups" script, and the user side "Scripts Manager" all in one Group Policy Object. We then applied it to our endpoint which was Group Policy joined and also Azure AD joined. And, hey, look at that. It worked perfectly.</p>
                                    <p>So once you know that works, now you're ready to do what's next which is you can take the scripts and you're just going to drag them one at a time into a folder. We'll talk about what we do with that folder next.</p>
                                    <p>As you do this, I would suggest you also rename them to have the order you're doing it in. So "01" is going to be the first one. That's the "Install AAD module" script. Let's go to the second one here, and we'll do "02." That's going to get the computer side stuff ("Get Computer Groups").</p>
                                    <p>The third thing we're going to do is to grab the "Get User Creds" script that we already produced. It's already wrapped up nicely in <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> format. Then the last thing we want to do is let's just go right for it and take the Group Policy Preferences for <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> item that we wrapped up earlier and shove it in there as well. I'll show you how we're going to do this.</p>
                                    <p>Remember what I showed you before. I like using Group Policy Preferences "Shortcuts" just as a little tester item because "Shortcuts" are really easy. You can see a "Desktop" shortcut. But everything we're about to do once you know what Azure AD group somebody is in, with "Item-level targeting" you can do item-level targeting everywhere and anywhere in <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> land. You just use the "WMI Query" and use the "Query" that I provided in the first video for either the user side or the computer side.</p>
                                    <p>Once you've taken your Group Policy settings and you've translated them down to XML settings, what we're going to do then is use the "<span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> Exporter Tool." <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> Exporter will be on machines that you also have the MMC console.</p>
                                    <p>Here's the exporter utility. We're going to "Create a new MSI installer." We're going to "Add Existing Files." We're going to add the files from this folder. We'll select all of them, but notice how the order is what we wanted: "01," "02," "03," and "04." Hey, look, "1," "2," "3," and "4." So that's good. We can see that the order matches.</p>
                                    <p>The one thing you have to change here is you don't want it to hit "Users &amp; Groups" because we're not targeting users really. We want to say to do this user side script thing for every user on a "Computer." See how it says "All Users." So we're changing it that even though this is a user side script, we're forcing it to go for every user on the "Computer." Same thing here. This Group Policy "Preferences" item that's really a user side item, we're forcing it to go for every user on the "Computer." We'll go ahead and click "Next" here and we'll call this "[<span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> ] MDM and Azure AD Check." So that's the name of our MSI. And "File name" "<span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> Azure AD Group Demo." There it is.</p>
                                    <p>At this point, I'm going to pause the video for two seconds and get this MSI over to my Azure AD joined machine. Hang tight for two seconds while I do that. Okay, we're back.</p>
                                    <p>This machine is Azure AD joined only. The idea is that he already has the "<span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> Client-Side Extension" using your MDM service. He has "<span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> MDM Licenses" delivered using your MDM service. You did this before in the Walk Before You Run video and also your Getting Started with <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> MDM. You've already done this.</p>
                                    <p>Now what we're doing is we're going to use our imagination just so I don't have to wait for Azure, Intune, MobileIron, or AirWatch. I'm just going to run this by hand. But again, in the real world this just happens naturally when you use you're MDM service. I'm just accelerating the hands of time here.</p>
                                    <p>Type "set." Do I see it? If I don't see it right away, that might mean I have to log off and log on. Let's go ahead and do that. That was one of the caveats. We'll go ahead and "Sign out" here and log back on as my Azure AD only guy here. This will trigger the script once again. We'll give this a second to settle in, and then let's take a look here.</p>
                                    <p>We'll type "set" in the Command Prompt, and there we go. We can see "AzureADUserGroups" is here, but where's the computer side stuff? That's going to require a reboot, so I'm going to pause once again. Actually, I don't want to pause yet because the Group Policy Preferences item is coming down also. There we go, as I spoke. That comes down also and evaluates to see if the group membership that you set through the WMI query is in fact there. You can see it certainly did ("EastSalesUsers"). It actually took effect right there.</p>
                                    <p>Let me go ahead and restart the machine and I'll come back and when I log back on after rebooting we'll see the computer side. Hang tight. Okay, I've now rebooted. I'm logging on again as my Azure only guy. By this point, the computer has already run the script, looked to Azure to see what's the story and performed the work. Let's go ahead and log on and take a look at it and see what happens.</p>
                                    <p>Okay, here we go. If I were to take a look and go to a Command Prompt and type "set" in the Command Prompt here, what do we see? There it is: "AzureADComputerGroups." You can see this computer is part of the group called "Computers with ‘Computer' in the Name."</p>
                                    <p>The point of the story is it's just that easy. All three of these videos started with doing the Group Policy version first, doing your small-scale test and making sure it works. Once you know it works, then you're off to the races. You just export and get it into an MSI. Then you can get it over to your MDM service to download and you're off to the races. It may take a log off and a log on for the user side to kick in, and it definitely takes a reboot for the computer side to kick in. And at that point, you're good to go.</p>
                                    <p>I hope this helps you out and you're looking to get started with <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> MDM real soon.</p>
                                    <p>Thanks. Bye-bye.</p>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>