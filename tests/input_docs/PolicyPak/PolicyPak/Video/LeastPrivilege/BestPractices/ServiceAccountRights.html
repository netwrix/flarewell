<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="_Skins_Netwrix_Website" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="[%=System.LinkedTitle%]|Least Privilege Manager|[%=System.LinkedTitle%]|Best Practices">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>Reduce or specify Service Account Rights</title>
        <link href="../../../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <script src="../../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="title tab bar" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../Overview.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div id="mc-main-content" role="main" data-mc-content-body="True">
                                    <h1>Reduce or specify Service Account Rights</h1>
                                    <p>Most services run under Local System which is WAY too much privileges. Instead, use PPLPM to specify exactly the right permissions for your services, including the token and access your service needs.</p>
                                    <p><iframe width="1700" height="956" src="https://www.youtube.com/embed/waVSO6KAoPw" title="Endpoint Policy Manager Least Priv Manager: Reduce or specify Service Account Rights" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="1"></iframe>
                                    </p>
                                    <p>Hi. This is Jeremy Moskowitz. In this video, I'm going to show you how you can manipulate a service account to have reduced privileges for exactly the right things you need instead of having maybe overblown privileges.</p>
                                    <p>To do this demonstration, I have a service called "hMailServer." It's an old and crusty mail server which works just fine. I'm going to go ahead and install it as domain admin here. It will work perfectly fine because as it gets installed by default it even says we're going to do the work as local system. Now that might be too much for what you want to do. What we're going to show in this example is how to trim the sails so it's not running as local system. It's going to have reduced rights and, therefore, have exactly the rights you need.</p>
                                    <p>But we've got to get it set up and show you that it actually works first, so we'll go ahead and run this thing. Now I'll show you when I double click into it, it starts and everything is just fine. It doesn't matter if we see it working or not. From this point forward you can assume that it's working.</p>
                                    <p>Now let's go ahead and create a new local account. I'm going to create a "New User" here called "service1" and give it a very simple "Password" here. We'll make it so that the "User cannot change password" and "Password never expires." So here's just a garden-variety local account that we want to use as the service.</p>
                                    <p>Now to adjust for this what you can do is go to "<code>services.msc</code>" as an admin. I'm going to change this service over. Let's take a look at "hMailServer" here. Let me "Stop" it. Then I'm going to change its brains. If I click on "Log On" here, we want to change it from "Local System account." Instead, we want to use "This account."</p>
                                    <p>If I give it "service1" here, there we go, and give it the right password, what happens here is it says, "The account .\service1 has been granted the Log On As A Service right." So it looks like it should just work perfectly, but let's go ahead and "Start" it and see that it in fact doesn't work perfectly.</p>
                                    <p>I'll go ahead and "Start" it. Now we'll run "hMailServer Administrator" which worked when it was running as local system. But now if we try to double click into it, what do we get? It just hangs here. It's trying to make contact to the server, and it's catching fire and it's not working. I'm going to give it a minute to time out, and you can see here's the timeout.</p>
                                    <p>So clearly, we're missing some permission in order to make this happen. Something's wrong. It's not working properly the way we expect. What we'll do instead is let's go ahead and I'll "Stop" this here.</p>
                                    <p>Now we're going to use the Group Policy Editor with PolicyPak to do the magic. This window I'm running as a domain admin. So if I run "<code>gpmc.msc</code>" here, I'm actually running as a domain admin to do the work here.</p>
                                    <p>What I'm going to do is I'm going to do this for my "East Sales Desktops" because that's where this service happens to be running. Of course, you can use filtering and so on to just get the right machines. I'm going to "Make HHServer work as expected with LOWER rights."</p>
                                    <p>What we'll do is right click here and click "Edit." This work has to be done on the computer side because I'm linking it over to desktops. So we'll go over to "PolicyPak" and get on over to the "Least Privilege Manager" part of the world here.</p>
                                    <p>Now what we'll do is click "Add" a "New Executable Policy." What we're after is the HHServer.exe. We'll "Use simple rule." I'm going to use "Path" for this example. Probably in real life you want to make something more secure like "Signature" and "File info." But for the purposes of what we're doing, this will work out just fine. I'm going to "Add file" and "Browse" for it. I've already got it here: "<code>C:\ProgramFiles (x86)\hMailServer\Bin</code>" and "hMailServer." Click on that guy.</p>
                                    <p>We don't want to necessarily "Run with elevated privileges." What we may want to do is "Run with customized token." This is where you need to know a little bit about what your service actually needs. Typically, your vendor will document what privileges are actually required. If you want to reduce the raw amount of privileges, this is a good way to do it.</p>
                                    <p>So we're going to "Run with customized token." One of the things you can do is "Use the original user token (Default)" or you can "Always create and use an elevated token." I'm going to do that for this example just to prove that it's working.</p>
                                    <p>You can also set things like "Token Privileges" where you can "Remove all" the privileges if you want to or add in specific ones. For instance, if I want to "Bypass traverse checking," I'll go ahead and add that guy and I'll select "Enabled" for that. Maybe I'll also add one which is going to let me "Load and unload device drivers." I don't think these are actually needed for this program, but it's just a good example. I'll show you where this will come into play in a little bit. I'll go ahead and click "Enabled" here. So now these two guys are "Enabled."</p>
                                    <p>This is where the magic happens. What you want to do here is "Scope" this because you're on the computer side not for "User processes" but for "User and System processes." In the "Scope Filter" you're going to specify once again not; here at "fabrikam.com." You're going to change your "Locations" back to the computer and pick the "service1" account, that guy. So now only this guy is going to get this particular lash-up that we just created. I'll go ahead and click "Finish," and we're off to the races. Let's just refresh this and make sure it came in there. There we go. We're off to the races.</p>
                                    <p>We'll go ahead and close this out. We'll make sure the service is actually not started. We'll go ahead and run GP Update ("<code>gpupdate</code>"). This is refreshing the rule about what's going to happen the next time the "hMailServer" is launched. We'll just give this a second to finish up here.</p>
                                    <p>Now we will "Start" it again. Now as we're doing this, the process that we want is getting the right attributes that we specified. How do we know this? We know this in a couple of ways. The first way, let's go ahead and try to rerun "hMailServer Administrator." If we double click this guy here, you can see we've already got it working and it's off to the races. So now we're configuring this guy to work with the service1 account that we created.</p>
                                    <p>Now while we're here as well, I want to show you one more thing. Let me go ahead and as administrator I also want to run Process Explorer ("procexp") just to show you what's happening underneath the hood here. Let me go ahead and run "<code>procexp.exe</code>." Then I want to show you this service, the hMailServer service here.</p>
                                    <p>We want to find "hmailserver." It's sawing through all these processes right now looking for it. There we go. We're looking for <code>hMailServer.exe</code>. When I right click over "<code>hMailServer.exe</code>" and go to "Properties" and go to "Security," you can see the privileges that are here. The only privileges that have been given are the "SeChangeNotifyPrivilege." That's the bypass traverse checking. </p>
                                    <p>Then the other guy we said is the "SeLoadDriverPrivilege." You can see that those guys are driven directly in. If you know that your process needs those, you can drive those right in and this is the way to do it. You can see that the "SeImpersonatePrivilege" is inherited.</p>
                                    <p>That's the deal. With that in mind, this gives you everything you need to know to take a service, reduce the permissions or customize the token, get it exactly the way you need. That way you don't have to run with local service account access if that's what you want to on your service.</p>
                                    <p>Hope this helps you out. Looking forward to helping you get started real soon.</p>
                                    <p>Thanks so much.</p>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>