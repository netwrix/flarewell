<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="_Skins_Netwrix_Website" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="[%=System.LinkedTitle%]|Least Privilege Manager|[%=System.LinkedTitle%]|Best Practices">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>Block PowerShell in General, Open up for specific items</title>
        <link href="../../../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <script src="../../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="title tab bar" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../Overview.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div id="mc-main-content" role="main" data-mc-content-body="True">
                                    <h1>Block PowerShell in General, Open up for specific items</h1>
                                    <p>Powershell on desktops? Terrible idea. Except when you need it. Check out this video to see how to kill PowerShell (generally) but open it up to allow specific. PS1 scripts to run as you need them to. With <span class="mc-variable PolicyPak.Product_Long_Name variable">Netwrix Endpoint Policy Manager (formerly PolicyPak)</span> Least Privilege Manager, it's easy !</p>
                                    <p><iframe width="1700" height="956" src="https://www.youtube.com/embed/Xzgr1gqekGU" title="Endpoint Policy Manager Least Priv: Block PowerShell, open up for specific scripts" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="1"></iframe>
                                    </p>
                                    <p>Hi. This is Jeremy Moskowitz. In this video, I'm going to show you how you can put the full smackdown on PowerShell and also open up PowerShell for very specific scenarios.</p>
                                    <p>I've got no policy set up here with PolicyPak at this time. Just to prove a point, if I go to "Command Prompt," that works. If I type "powershell," that works. If I try to go to "Windows PowerShell" here, that works. So you can see PowerShell is enabled.</p>
                                    <p>The first thing I want to do is create a policy. In fact, I'm going to create two policies that are going to put the smackdown on PowerShell. There are a couple ways you can do it. I actually think both are good. I actually have these pre-staged just to make this demo go a little bit faster.</p>
                                    <p>The first one is denying PowerShell by name. So whenever you try to run anything with "<code>powersh</code>" in the "Name," it's automatically going to "Deny execution." So if it has "powersh" in the name, that is going to be smacked down. That's thing number one. I have to reenable that guy. Let's go ahead and go back there and the "State" is going to be back to "Enabled." That's way number one.</p>
                                    <p>A second and additionally powerful way to do it is to say if there's anything "recursive" in the "WindowsPowerShell" folder, just don't let that run. Just "Deny execution" on that. So that's two different ways. That way if somebody were to try to copy PowerShell or some other kind of way, long story short, you have a couple of different angles to turn that off right there. So that's killing PowerShell there.</p>
                                    <p>Let's just start and just see that that actually worked as expected. If I now run GP Update ("<code>gpupdate</code>"), this could happen naturally at logon. You could wait for Group Policy to process in the background. We just run alongside the Group Policy engine just like everything else runs alongside the Group Policy engine. Give this a second to finish up.</p>
                                    <p>Now that that's done, let's go ahead and type "powershell" here. What happens? You can see it says, "This program is blocked by group policy." This is a system message. You might think we have something to do with AppLocker. We don't. This is just a standard system message.</p>
                                    <p>If I were to try to now go to "Windows PowerShell" here, "This app has been blocked by your system administrator." If I were to try to run a PowerShell script that could have been malware, right click over it and select "Run with PowerShell," "This app has been blocked by your system administrator." That's also blocked just the way we want it to be.</p>
                                    <p>But you might have a scenario where you want a certain specific file or files to work. Here's an example: "<code>\\dc2016\share\ITScripts</code>." With ITScripts I have a good PowerShell that I want to run but only when I've staged it here in "dc2016 &gt; share." If I right click here and go to "Run with PowerShell," "This app has been blocked by your system administrator." It's still not going to work. It has been blocked by my system admin.</p>
                                    <p>So what are we're going to do? We're just going to open that up. I already have a rule staged just to make this demo go a little faster. We're saying whenever anybody tries to run "<code>\\dcshare2016\SHARE\ITScripts\PS – From IT</code>," then go ahead and "Allow and log." It doesn't have to be elevated. It just has to run. I already have this "Disabled." Let me go ahead and check "Enabled" and turn that back on.</p>
                                    <p>That's all there is to it. You saw ten seconds ago that script wouldn't run. Let me go ahead and run GP Update ("<code>gpupdate</code>"). Then we'll finish up and we'll see that script will be bypassed even though generally PowerShell is shot. Let's go ahead and give this a second to finish up here. Now let's go ahead and right click over "PS – From IT" and select "Run with PowerShell." There we go. "Hello From IT Department."</p>
                                    <p>But other items, like I said, if we were to try to go back to "Scripts," here's a random PowerShell "Malware" that I have. It's not really malware. If I were to "Run with PowerShell," "This app has been blocked by your system administrator."</p>
                                    <p>Hopefully, this satisfies the case of taking PowerShell out of business but reenabling PowerShell for very specific scripts that you might want to stage yourself or otherwise have available for users.</p>
                                    <p>If you're looking to get started with PolicyPak, we want to help you to help you get started real soon. So give us a buzz or fill out a form, and we'll be in touch and we'll get you started.</p>
                                    <p>Thank you very much, and talk to you soon.</p>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>