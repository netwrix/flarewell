<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="_Skins_Netwrix_Website" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="[%=System.LinkedTitle%]|Getting Started with Endpoint Policy Manager (Misc)|[%=System.LinkedTitle%]|Tips, Tricks and FAQs">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>How do I get Azure AD SIDs and use them with Item Level Targeting?</title>
        <link href="../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <script src="../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="title tab bar" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../Overview.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div id="mc-main-content" role="main" data-mc-content-body="True">
                                    <h1>How do I get Azure AD SIDs and use them with Item Level Targeting?</h1>
                                    <p class="Step-Reset" data-mc-autonum="&lt;b&gt;Step 1 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 1 – </b></span></span>Before you can use Azure Accounts under Item Level Targeting (ITM), you first need to know the Azure AD SIDs for any of the Azure Accounts you wish to target. To find an Azure Account's SID you can:</p>
                                    <ol>
                                        <li value="1">
                                            <p>Look in the Windows Registry of a computer where that Azure User has successfully logged on to at least once. The registry path to look under is:</p>
                                            <p>
                                                <div class="codeSnippet">
                                                    <div style="mc-code-lang: PlainText;" class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList</code></pre>
                                                    </div>
                                                </div>
                                            </p>
                                            <p>Once at that path you can select each folder until you find the AAD SID that matches the Azure User account you wish to target. In the example below that would be:</p>
                                            <p>SID: S-1-12-1-3603547745-1252762009-756918658-301435180</p>
                                            <p>AAD User: <a href="mailto:EastSalesUser1@Fabrikam1000.com">EastSalesUser1@Fabrikam1000.com</a></p>
                                            <p style="text-align: center;">
                                                <img alt="" height="306" src="../../Resources/Images/ItemLevelTartgeting/1_1_image.png" width="1050" />
                                            </p>
                                        </li>
                                        <li value="2">
                                            <p>Have the Azure user run&#160;"WHOAMI /User" from a CMD prompt once logged in to the computer, then copy the SID text and send itto you.</p>
                                            <p style="text-align: center;"> <img alt="" height="267" src="../../Resources/Images/ItemLevelTartgeting/1_2_image.png" width="892" /></p>
                                        </li>
                                        <li value="3">
                                            <p>Use PowerShell to connect to Azure, then use a function&#160;to convert Object IDs to SIDs:&#160;</p>
                                            <p>
                                                <div class="codeSnippet">
                                                    <div style="mc-code-lang: PlainText;" class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>#Run PowerShell As Administrator&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Set-ExecutionPolicy Bypass -scope Process -Force&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br />Install-Module -Name AzureAD -Force&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Import-Module -Name AzureAD&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#Answer YES if prompted to install NuGet<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;#Once modules above are installed you can use the command below to connect to Azure&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# Use&#160;an account without MFA enabled&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Connect-AzureAD&#160;<br />function Convert-ObjectIdToSid&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br />{&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;param([String] $ObjectId)<br />&#160;&#160;&#160;&#160;$d=[UInt32[]]::new(4);[Buffer]::BlockCopy([Guid]::Parse($ObjectId).<br />ToByteArray(),0,$d,0,16);"S-1-12-1-$d".Replace(' ','-')&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br /># Examples of conversion commands to run:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br /># Get and convert all Azure Users:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Get-AzureADUser | ForEach&#160;<br />{ [pscustomobject] @{ Name= $_.DisplayName; Sid=Convert-ObjectIdToSid($_.ObjectId)}}<br />#Get and convert Azure Users whose names begin with "EastSalesUser"&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br />Get-AzureADUser -SearchString "EastSalesUser" | ForEach { [pscustomobject] @{ Name= $_.DisplayName; Sid=Convert-ObjectIdToSid($_.ObjectId)}}<br /></code></pre>
                                                    </div>
                                                </div>
                                            </p>
                                        </li>
                                    </ol>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 2 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 2 – </b></span></span>Once you have the SID, you should be all set. Edit your <span class="mc-variable PolicyPak.Product_Long_Name variable">Netwrix Endpoint Policy Manager (formerly PolicyPak)</span> Policy rule and enable Item Level Targeting, then click  <b>Edit…</b>.</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/ItemLevelTartgeting/1_3_image-20200129215924-2.png" width="766" />
                                    </p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 3 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 3 – </b></span></span>Expand the drop-down list under New Item ,select <b>User</b> then put in any onprem user  and select <b>Match by SID</b>, then save the policy.</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/ItemLevelTartgeting/1_5_image-20200129215924-3.png" width="482" />
                                    </p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 4 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 4 – </b></span></span>Right click the policy and then  export it  as XML.</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/ItemLevelTartgeting/1_7_image-20200129215924-4.png" width="375" />
                                    </p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 5 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 5 – </b></span></span>Open the XML in notepad, notepad++, etc. Then carefully  replace the SID in the XML with what you got in step 1 (optionally replace name as well).</p>
                                    <p>Before:</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/ItemLevelTartgeting/1_9_image-20200129215924-5.png" width="722" />
                                    </p>
                                    <p>After:</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/ItemLevelTartgeting/1_11_image-20200129215924-6.png" width="757" />
                                    </p>
                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 6 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 6 – </b></span></span>Now save the edited XML with a descriptive name. The new XML file can now be used normally l within <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> for the module the policy was created for. In the example above the policy was created for Least Privilege Manager so this XML can be used for LPM in Cloud, MDM, or the GPO version of <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span>.</p>
                                    <p>After importing the new XML into <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> the ILT will show the correct values for the Azure account.</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/ItemLevelTartgeting/1_13_image-20200129215924-7.png" width="589" />
                                    </p>
                                    <p class="Note-1" data-mc-autonum="&lt;b&gt;NOTE: &lt;/b&gt;"><span class="autonumber"><span class="Note"><b>NOTE: </b></span></span> Azure Groups don't have SID translations at all, so you would need to add multiple  user SIDS if you want multiple people to be able to do the activity.</p>
                                    <p>Other Considerations:</p>
                                    <p>For MDM, when using an XML created this way in the Exporter Tool, you must change the Install For option to <b>Computer</b>.</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/ItemLevelTartgeting/1_15_image-20200129215924-8.png" width="613" />
                                    </p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/ItemLevelTartgeting/1_17_image-20200129215924-9.png" width="611" />
                                    </p>
                                    <p>Once the policy is applied you can launch the application, run task manager, and add the Elevated column to verify that the policy applied.</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/ItemLevelTartgeting/1_19_image-20200129215924-10.png" width="730" />
                                    </p>
                                    <p>Alternatively, check the <span class="mc-variable PolicyPak.Product_Short_Name variable">Endpoint Policy Manager</span> event log:</p>
                                    <p style="text-align: center;">
                                        <img src="../../Resources/Images/ItemLevelTartgeting/1_21_image-20200129215924-11.png" />
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>