<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_CSH_NPR_Skin" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../" data-mc-has-content-body="True" data-mc-toc-path="[%=System.LinkedTitle%]|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="online">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../../../Skins/Favicons/browserconfig.xml" />
        <link rel="shortcut icon" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="32x32" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../../Skins/Favicons/favicon-16x16.png" /><title>Permissions for  Exchange Online Auditing</title>
        <!-- Google Tag Manager -->
        <!-- <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-NKJ33G');</script> -->
        <!-- End Google Tag Manager -->
        <link rel="shortcut icon" href="https://img.netwrix.com/fav.ico" />
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <link href="../../../../Resources/TableStyles/Sb Table 1.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <link rel="shortcut icon" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="32x32" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../../Skins/Favicons/favicon-16x16.png" />
        <script src="../../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="title tab bar" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1260px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../Overview.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NKJ33G" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-2538779-18">
                                    </script>
                                    <script>/* <![CDATA[ */
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'UA-2538779-18');
		/* ]]> */</script>
                                    <div class="searchbar">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie _Skins_Search mc-component">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search here" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="main">
                                        <div class="nocontent">
                                            <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                            </div>
                                        </div>
                                        <div class="wrapper">
                                            <div class="toc">
                                                <ul class="nocontent menu _Skins_TOC mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/Auditor__Auditor.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                </ul>
                                            </div>
                                            <div class="content">
                                                <div role="main" id="mc-main-content">
                                                    <h1><a name="kanchor176"></a>Permissions for  Exchange Online Auditing</h1>
                                                    <p class="Note"><span class="mc-variable Auditor.Product_Short_Name variable">Auditor</span> allows you to audit Office 365 organizations that have established modern authentication as their identity management approach, including support for <a href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-howitworks" target="_blank" title="multi-factor authentication (MFA)" alt="multi-factor authentication (MFA)">multi-factor authentication (MFA)</a>. To learn more about modern authentication, refer to the following Microsoft article: <a href="https://docs.microsoft.com/en-us/office365/enterprise/hybrid-modern-auth-overview#BKMK_WhatisModAuth" target="_blank" title="What is modern authentication" alt="What is modern authentication">What is modern authentication</a>. </p>
                                                    <p style="text-align: left;">In this scenario, <span class="mc-variable Auditor.Product_Long_Name variable">Netwrix Auditor</span> will access the cloud-based infrastructure via Microsoft Graph and other modern APIs, being authenticated through a pre-configured Microsoft Entra ID (formerly Azure AD) application with appropriate access permissions. So, you should register an Microsoft Entra ID app and provide its settings to <span class="mc-variable Auditor.Product_Short_Name variable">Auditor</span>&#160; when configuring a monitored item.</p>
                                                    <h2><a name="Configur2"></a>Configure the Microsoft Entra ID App for Auditing Exchange Online</h2>
                                                    <p>Follow the steps to use a data collecting account with modern authentication.</p>
                                                    <p class="Step-Reset" data-mc-autonum="&lt;b&gt;Step 1 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 1 – </b></span></span>Create a <span class="mc-variable MyVariables.Azure_AD_app variable">Microsoft Entra ID</span> app that will be used for modern authentication. See the <a href="ModernAuth.htm#Creating" target="_parent" title="Create and Register a New App in Microsoft Entra ID" alt="Create and Register a New App in Microsoft Entra ID" class="MCXref xref">Create and Register a New App in Microsoft Entra ID</a> topic for additional information.</p>
                                                    <p class="Note-1" data-mc-autonum="&lt;b&gt;NOTE: &lt;/b&gt;"><span class="autonumber"><span class="Note"><b>NOTE: </b></span></span>After you start a new monitoring plan and select a data source in the first step, you will be asked to enter a default data collection account. However, this step is not needed for Exchange Online as it cannot be used. Thus, there is no need to grant any permissions to this account. Instead, you will need to configure a modern authentication app and give the necessary permissions there.</p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 2 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 2 – </b></span></span>Grant required permissions to that application. See the <a href="ModernAuth.htm#Granting" target="_parent" title="Grant Required Permissions" alt="Grant Required Permissions" class="MCXref xref">Grant Required Permissions</a>  topic   for additional information.</p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 3 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 3 – </b></span></span>Grant required roles to that application. See the <a href="ModernAuth.htm#Granting2" target="_parent" title="Grant Required Roles" alt="Grant Required Roles" class="MCXref xref">Grant Required Roles</a>  topic  for additional information.</p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 4 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 4 – </b></span></span>Configure client secret for that application. See the <a href="ModernAuth.htm#Configur" target="_parent" title="Configure Client Secret" alt="Configure Client Secret" class="MCXref xref">Configure Client Secret</a>  topic  for additional information.</p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 5 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 5 – </b></span></span>Obtain tenant ID – you will need it when configuring a monitored item (Office 365 tenant) settings. See the <a href="ModernAuth.htm#Step4" target="_parent" title="Obtain the Tenant Name" alt="Obtain the Tenant Name" class="MCXref xref">Obtain the Tenant Name</a>  topic  for additional information.</p>
                                                    <h2><a name="Non-owne2"></a>Non-owner Mailbox Access Audit Configuration</h2>
                                                    <p style="text-align: left;">To prepare for non-owner mailbox access auditing in the Exchange Online organization, you will need to take several configuration steps, creating a <span class="mc-variable MyVariables.Azure_AD_app variable">Microsoft Entra ID</span> app with the required permissions and instructing this app to automatically apply the necessary audit settings.</p>
                                                    <p style="text-align: left;">Follow the steps to configure a non-owner mailbox access audit.</p>
                                                    <p value="1" class="Step-Reset" data-mc-autonum="&lt;b&gt;Step 1 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 1 – </b></span></span>Install the <b>Exchange Online PowerShell V3</b> module. There are three versions in the repository: 3.0.0, 3.1.0 and 3.2.0.</p>
                                                    <p class="Note-1" data-mc-autonum="&lt;b&gt;NOTE: &lt;/b&gt;"><span class="autonumber"><span class="Note"><b>NOTE: </b></span></span>Make sure you are using the version specified in the <a href="https://docs.microsoft.com/en-us/powershell/exchange/app-only-auth-powershell-v2?view=exchange-ps" target="_blank" title="App-only authentication for unattended scripts in Exchange Online PowerShell and Security &amp; Compliance PowerShell" alt="App-only authentication for unattended scripts in Exchange Online PowerShell and Security &amp; Compliance PowerShell">App-only authentication for unattended scripts in Exchange Online PowerShell and Security &amp; Compliance PowerShell  </a>Microsoft article.</p>
                                                    <p value="2" class="Step" data-mc-autonum="&lt;b&gt;Step 2 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 2 – </b></span></span>In the <b>Microsoft Entra ID admin center</b>, create and register an <span class="mc-variable MyVariables.Azure_AD_app variable">Microsoft Entra ID</span> app, as described in the related <a href="https://docs.microsoft.com/en-us/powershell/exchange/connect-to-exchange-online-powershell?view=exchange-ps" target="_blank" title="Connect to Exchange Online PowerShell" alt="Connect to Exchange Online PowerShell">Connect to Exchange Online PowerShell </a>Microsoft article.</p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 3 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 3 – </b></span></span>At the top of the <b>Request API permissions</b> pane, click the <b>APIs my organization uses</b> tab and search for <i>Office 365 Exchange Online</i>.</p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 4 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 4 – </b></span></span>Click on the <i>Office 365 Exchange Online</i> entry in the list of apps found.</p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 5 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 5 – </b></span></span>
                Proceed with adding the permissions for this app: select <b>Application permissions</b> and then select <b>Exchange.ManageAsApp</b>.</p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 6 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 6 – </b></span></span>Grant admin consent to the tenant (that is, for the Office 365 organization whose audit data will be collected by the newly registered app).
		 Go to the <b>new app settings &gt; API permissions</b> and click <b>Grant admin consent for</b><i>&lt;tenant name&gt;</i>. 
			When prompted to confirm granting, click <b>Yes</b>.
            </p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 7 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 7 – </b></span></span>Go to <b>Azure Active Directory</b> — <b>Roles and administrators</b> and assign <b>Exchange Administrator</b> role.</p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 8 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 8 – </b></span></span>Download the PowerShell script for certificate creation, as provided in the <a href="https://docs.microsoft.com/en-us/powershell/exchange/app-only-auth-powershell-v2?view=exchange-ps#step-3-generate-a-self-signed-certificate" target="_blank" title="Generate a self-signed certificate" alt="Generate a self-signed certificate">Generate a self-signed certificate </a>Microsoft article. </p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 9 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 9 – </b></span></span>To create a self-signed certificate to be used by the app, run the following command:</p>
                                                    <div class="codeSnippet">
                                                        <div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>&#160;.\Create-SelfSignedCertificate.ps1 -CommonName "MyCompanyName" -StartDate 2020-04-01 -EndDate 2022-04-01</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>where:</p>
                                                    <p><code>CommonName</code> — specify <i>"Netwrix Auditor"</i></p>
                                                    <p><code>StartDate</code> — set to current date</p>
                                                    <p><code>EndDate</code> — set to 2 years from now</p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 10 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 10 – </b></span></span>When prompted to specify a password, click <b>Enter</b>.</p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 11 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 11 – </b></span></span>Go to <b>Manage &gt; Certificates &amp; secrets</b>, click <b>Upload certificate</b> and upload the<i>.crt</i> file you have just created.</p>
                                                    <p><a class="MCPopupThumbnailLink MCPopupThumbnailPopup" href="../../../../Resources/Images/Auditor/Configuration/AzureADapp/certificates_secrets.png"><a class="MCPopupThumbnailLink MCPopupThumbnailPopup" href="../../../../Resources/Images/Auditor/Configuration/AzureADapp/certificates_secrets.png"><img class="MCPopupThumbnail img imgMCPopupThumbnail imgimg" data-mc-width="1305" data-mc-height="666" src="../../../../Resources/Images/Auditor/Configuration/AzureADapp/certificates_secrets_thumb_0_0.png" style="width: 500px;height: auto;mc-thumbnail: popup;mc-thumbnail-max-height: auto;" tabindex="" /></a></a>
                                                    </p>
                                                    <p class="Step" data-mc-autonum="&lt;b&gt;Step 12 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 12 – </b></span></span>To create Exchange Online connection session, you can provide certificate file path or thumbprint. If you want to use a file path, run the following command: </p>
                                                    <div class="codeSnippet">
                                                        <div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>Connect-ExchangeOnline -CertificateFilePath "full_path_to_certificate"&#160;<br />-AppID "yourAppId" -Organization "Office365_tenant_name"</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>Application (client ID) can be found in the <b>Overview</b> page.</p>
                                                    <p style="text-align: left;"><a class="MCPopupThumbnailLink MCPopupThumbnailPopup" href="../../../../Resources/Images/Auditor/Configuration/AzureADapp/tenant_id.png"><a class="MCPopupThumbnailLink MCPopupThumbnailPopup" href="../../../../Resources/Images/Auditor/Configuration/AzureADapp/tenant_id.png"><img class="MCPopupThumbnail img imgMCPopupThumbnail imgimg" data-mc-width="1455" data-mc-height="649" src="../../../../Resources/Images/Auditor/Configuration/AzureADapp/tenant_id_thumb_0_0.png" style="width: 600px;height: auto;mc-thumbnail: popup;mc-thumbnail-max-height: auto;" tabindex="" /></a></a>
                                                    </p>
                                                    <p style="text-align: left;"> For example: </p>
                                                    <div class="codeSnippet">
                                                        <div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>Connect-ExchangeOnline -CertificateFilePath "C:\Path\MyCompanyName1.pfx"&#160;<br />-AppId "402b12a2-fb2b-4222-8f54-5596def1" -Organization "myorganization123.onmicrosoft.com"</code></pre>
                                                        </div>
                                                    </div>
                                                    <p style="text-align: left;">You can use certificate thumbprint instead of file path. For that, import the certificate to the local certificate store, using the following command:</p>
                                                    <div class="codeSnippet">
                                                        <div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>Import-PfxCertificate -FilePath "path_to_pfx_certificate" -CertStoreLocation Cert:\CurrentUser\My</code></pre>
                                                        </div>
                                                    </div>
                                                    <p style="text-align: left;">Then run the command like following: </p>
                                                    <div class="codeSnippet">
                                                        <div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>Connect-ExchangeOnline -CertificateThumbprint 6AEА5A82911ААА3F76FEE149B7B52А70DDFD88 -AppId a14a 822d-f228-412b-9222-281de23&#160;<br />-Organization myorganization123.onmicrosoft.com</code></pre>
                                                        </div>
                                                    </div>
                                                    <p style="text-align: left;">Finally, run the following command to end the session: </p>
                                                    <div class="codeSnippet">
                                                        <div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>Disconnect-ExchangeOnline -Confirm:$false</code></pre>
                                                        </div>
                                                    </div>
                                                    <p class="Tip" style="text-align: left;" data-mc-autonum="&lt;b&gt;&lt;span style=&quot;color: #1560ce;&quot; class=&quot;mcFormatColor&quot;&gt;TIP: &lt;/span&gt;&lt;/b&gt;">To automate the process described above, you can create a a script comprising the corresponding commands and schedule its launch.</p>
                                                    <h2>Non-owner Mailbox Access Audit: Manual Configuration</h2>
                                                    <p style="text-align: left;">If you plan to manually apply the audit settings required to audit non-owner mailbox access in Exchange Online organization, you will need to create a remote PowerShell session to Exchange Online. Follow the steps to do so.</p>
                                                    <p value="1" class="Step-Reset" data-mc-autonum="&lt;b&gt;Step 1 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 1 – </b></span></span>Install the Exchange Online PowerShell V2 module as described in the <a href="https://docs.microsoft.com/en-us/powershell/exchange/exchange-online-powershell-v2?view=exchange-ps" target="_blank" title="About the Exchange Online PowerShell module" alt="About the Exchange Online PowerShell module">About the Exchange Online PowerShell module</a> Microsoft article.</p>
                                                    <p class="Important" data-mc-autonum="&lt;b&gt;&lt;span style=&quot;color: #1560ce;&quot; class=&quot;mcFormatColor&quot;&gt;IMPORTANT! &lt;/span&gt;&lt;/b&gt;">Make sure to install the latest version.</p>
                                                    <p value="2" class="Step" data-mc-autonum="&lt;b&gt;Step 2 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 2 – </b></span></span> Launch PowerShell and connect to Exchange Online, as described in the <a href="https://docs.microsoft.com/en-us/powershell/exchange/exchange-online-powershell-v2?view=exchange-ps" target="_blank" title="About the Exchange Online PowerShell module" alt="About the Exchange Online PowerShell module">About the Exchange Online PowerShell module</a> Microsoft article.</p>
                                                    <p value="3" class="Step" data-mc-autonum="&lt;b&gt;Step 3 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 3 – </b></span></span>Run the cmdlet, depending on the mailboxes you plan to audit (all mailboxes or selected individual mailbox):</p>
                                                    <table style="width: 100%;mc-table-style: url('../../../../Resources/TableStyles/Sb Table 1.css');" class="TableStyle-Sb_Table_1" cellspacing="21">
                                                        <col class="TableStyle-Sb_Table_1-Column-Column1" style="width: 67px;" />
                                                        <col class="TableStyle-Sb_Table_1-Column-Column1" style="width: 75%;" />
                                                        <thead>
                                                            <tr class="TableStyle-Sb_Table_1-Head-Header1">
                                                                <th class="TableStyle-Sb_Table_1-HeadE-Column1-Header1">For</th>
                                                                <th class="TableStyle-Sb_Table_1-HeadD-Column1-Header1">Command</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr class="TableStyle-Sb_Table_1-Body-Body1">
                                                                <td class="TableStyle-Sb_Table_1-BodyE-Column1-Body1">
                                                                    <p style="text-align: left;">All</p>
                                                                </td>
                                                                <td class="TableStyle-Sb_Table_1-BodyD-Column1-Body1">
                                                                    <p> Execute the following cmdlet:</p>
                                                                    <p class="Command-Line" style="text-align: left;">Get-ExoMailbox -PropertySets Minimum -RecipientTypeDetails UserMailbox,SharedMailbox,EquipmentMailbox,LinkedMailbox,RoomMailbox | Set-Mailbox -AuditEnabled $true –AuditAdmin Update,Copy,Move,MoveToDeletedItems,SoftDelete,HardDelete,FolderBind,SendAs,SendOnBehalf,Create –AuditDelegate Update,Move,MoveToDeletedItems,SoftDelete,HardDelete,FolderBind,SendAs,SendOnBehalf,Create</p>
                                                                </td>
                                                            </tr>
                                                            <tr class="TableStyle-Sb_Table_1-Body-Body2">
                                                                <td class="TableStyle-Sb_Table_1-BodyB-Column1-Body2">
                                                                    <p style="text-align: left;">Selected</p>
                                                                </td>
                                                                <td class="TableStyle-Sb_Table_1-BodyA-Column1-Body2">
                                                                    <p> Execute the following cmdlet:</p>
                                                                    <p class="Command-Line" style="text-align: left;">Set-Mailbox -Identity {0} -AuditEnabled $true –AuditAdmin Update,Copy,Move,MoveToDeletedItems,SoftDelete,HardDelete,FolderBind,SendAs,SendOnBehalf,Create –AuditDelegate Update,Move,MoveToDeletedItems,SoftDelete,HardDelete,FolderBind,SendAs,SendOnBehalf,Create</p>
                                                                    <p>Where the <i>{0}</i> character must be replaced with any of the following:</p>
                                                                    <ul>
                                                                        <li value="1"><span style="font-family: 'Courier New';">Display Name. Example: "Michael Jones"</span>
                                                                        </li>
                                                                        <li style="font-family: 'Courier New';text-align: left;" value="2">Domain\User. Example: enterprise.local\MJones</li>
                                                                        <li style="font-family: 'Courier New';text-align: left;" value="3">Email address. Example: analyst@enterprise.onmicrosoft.com</li>
                                                                        <li style="font-family: 'Courier New';" value="4">GUID. Example: {c43a7694-ba06-46d2-ac9b-205f25dfb32d}</li>
                                                                        <li style="font-family: 'Courier New';text-align: left;" value="5">LegacyExchangeDN. Example: /o=EnterpriseDev/ou=Exchange Administrative Group(FYDIBOHF23SPDLT)/cn=Recipients/cn=97da560450c942aba<br />81b2da46c60858a-analyst</li>
                                                                        <li style="font-family: 'Courier New';" value="6">SamAccountName. Example: MANAG58792-1758064122</li>
                                                                        <li style="font-family: 'Courier New';text-align: left;" value="7">(DN) Distinguished name. Example: CN=MJones,CN=Users,DC=enterprisedc1,DC=enterprise,DC=local</li>
                                                                        <li style="font-family: 'Courier New';text-align: left;" value="8">User ID or User Principal Name. Example: MJones@enterprise.onmicrosoft.com</li>
                                                                    </ul>
                                                                    <p class="Note" data-mc-autonum="&lt;b&gt;&lt;span style=&quot;color: #1560ce;&quot; class=&quot;mcFormatColor&quot;&gt;NOTE: &lt;/span&gt;&lt;/b&gt;">If you are going to audit multiple individual mailboxes, run the cmdlet for each mailbox you need.</p>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>