<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_Stealthbits_WebsiteSkin" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../" data-mc-has-content-body="True" data-mc-toc-path="[%=System.LinkedTitle%]|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../../../Skins/Favicons/browserconfig.xml" />
        <link rel="shortcut icon" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="32x32" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../../Skins/Favicons/favicon-16x16.png" /><title>Recommended Configurations </title>
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <link rel="shortcut icon" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="32x32" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../../Skins/Favicons/favicon-16x16.png" />
        <script src="../../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="complementary" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="Main navigation and search" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../Overview.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <div class="nocontent">
                                        <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                        </div>
                                    </div>
                                    <p>
                                        <script type="text/javascript" src="../../../../Resources/zzJavaScript/plugins.min.js">
                                        </script>
                                    </p>
                                    <div role="main" id="mc-main-content">
                                        <h1>Recommended Configurations </h1>
                                        <p>The following sections describe the recommended configurations for the SQL Solution 0.Collection Job Group and the Azure SQL 0.Collection Job Group. </p>
                                        <p class="Note-1" data-mc-autonum="&lt;b&gt;NOTE: &lt;/b&gt;"><span class="autonumber"><span class="Note"><b>NOTE: </b></span></span>The SQL Solution Jobs report on both the SQL and Azure SQL Collection Jobs.</p>
                                        <h2>SQL Solution 0.Collection Job Group</h2>
                                        <p>The SQL Solution has been configured to inherit down from the <span style="font-weight: bold;">SQL</span> &gt; <span style="font-weight: bold;">Settings</span> node. However, it is best practice to assign the host list and the Connection Profile at the data collection level, the 0.Collection Job Group. Once these are assigned to the job group, it can be run directly or scheduled.</p>
                                        <p class="Bold_Subheading">Dependencies</p>
                                        <ul>
                                            <li>.Active Directory Inventory Job Group run successfully</li>
                                            <li>For Activity Auditing – SQL Server Audit Specifications to be configured on the target databases<ul><li>Audit destination must be a binary file</li><li>See the Microsoft <a href="https://docs.microsoft.com/en-us/sql/relational-databases/security/auditing/create-a-server-audit-and-database-audit-specification" class="Hyperlink" target="_blank" title="Opens the Create a Server Audit and Database Audit Specification article in a new window" alt="Opens the Create a Server Audit and Database Audit Specification article in a new window">Create a Server Audit and Database Audit Specification</a> article for additional information.</li></ul></li>
                                            <li>For the SQL_SecurityAssessment Job – One or more of the following jobs or job groups must be run to produce results:<ul><li><a href="Collection/Overview.htm" title="Navigates to the 0.Collection Job Group section" alt="Navigates to the 0.Collection Job Group section" target="_parent" class="MCXref xref">0.Collection &gt; SQL Job Group</a></li><li><a href="UsersRoles/Overview.htm" title="Navigates to the SQL_PasswordIssues Job section" alt="Navigates to the SQL_PasswordIssues Job section" target="_parent" class="MCXref xref">1.Users and Roles Job Group</a></li><li><a href="Permissions/Overview.htm" title="Navigates to the SQL_PublicPermissions Job section" alt="Navigates to the SQL_PublicPermissions Job section" target="_parent" class="MCXref xref">3.Permissions Job Group</a></li><li><a href="SensitiveData/Overview.htm" title="Navigates to the 5.Sensitive Data Job Group section" alt="Navigates to the 5.Sensitive Data Job Group section" target="_parent" class="MCXref xref">5.Sensitive Data Job Group</a></li><li><a href="../../Windows/PrivilegedAccounts/Overview.htm" title="Navigates to the SG_ServiceAccounts Job section" alt="Navigates to the SG_ServiceAccounts Job section" target="_parent" class="MCXref xref">Privileged Accounts Job Group</a></li><li><a href="../../Windows/PrivilegedAccounts/Overview.htm" title="Navigates to the SG_LocalAdmins Job section" alt="Navigates to the SG_LocalAdmins Job section" target="_parent" class="MCXref xref">Privileged Accounts Job Group</a></li></ul></li>
                                        </ul>
                                        <p>Some of the 0.Collection Job Group queries can be scoped to target specific databases/instances. However, it is necessary for the SA_SQL_Instances table to be populated before attempting to scope the queries. Therefore, the <a href="Collection/0-SQL_InstanceDiscovery.htm" title="0-SQL_InstanceDiscovery Job" alt="0-SQL_InstanceDiscovery Job" target="_parent" class="MCXref xref">0-SQL_InstanceDiscovery Job</a> must be manually executed before attempting to scope the 0.Collection Job Group queries.</p>
                                        <p class="Bold_Subheading">Targeted Host(s)</p>
                                        <p>The 0.Collection Job Group has been set to run against the following default dynamic host list:</p>
                                        <ul>
                                            <li>All Microsoft SQL Server Hosts<p class="Note-1" data-mc-autonum="&lt;b&gt;NOTE: &lt;/b&gt;"><span class="autonumber"><span class="Note"><b>NOTE: </b></span></span>Default dynamic host lists are populated from hosts in the Host Master Table which meet the host inventory criteria for the list. Ensure the appropriate host list(s) have been populated through host inventory results.</p></li>
                                        </ul>
                                        <p class="Bold_Subheading">Connection Profile</p>
                                        <p>The SQL Data Collector requires a specific set of permissions. See the Permissions section for necessary permissions. The account used can be either an Active Directory account or a SQL account. Once the account has been provisioned, create a custom Connection Profile containing the credentials for the targeted environment. See the <a href="../../../Admin/DataCollector/SQL/ConfigureJob.htm" target="_parent" title="Navigates to the SQL Custom Connection Profile &amp; Default Dynamic Host List section" alt="Navigates to the SQL Custom Connection Profile &amp; Default Dynamic Host List section" class="MCXref xref">SQL&#160;Custom Connection Profile &amp; Default Dynamic Host List</a> topic for additional information.</p>
                                        <p>The Connection Profile should be assigned under the <span style="font-weight: bold;">SQL</span> &gt; <span style="font-weight: bold;">0.Collection</span> &gt; <span style="font-weight: bold;">Settings</span> &gt; <span style="font-weight: bold;">Connection</span> node. It is set to <span style="font-weight: bold;">Use the Default Profile</span>, as configured at the global settings level. However, since this may not be the Connection Profile with the necessary permissions for the assigned hosts, click the radio button for the <span style="font-weight: bold;">Select one of the following user defined profiles</span> option and select the appropriate Connection Profile drop-down menu. </p>
                                        <p>See the <a href="../../../Admin/Settings/Connection/Overview.htm" target="_parent" title="Navigates to the Connection section" alt="Navigates to the Connection section" class="MCXref xref">Connection</a> topic for additional information.</p>
                                        <p class="Bold_Subheading">Schedule Frequency</p>
                                        <p>One of the most important decisions to make is how frequently to collect this data. The SQL Job Group can be scheduled to run as desired depending on the types of auditing being conducted and the scope of the target environment. The general recommendation is to schedule the solution to run daily. </p>
                                        <p class="Bold_Subheading">Run Order</p>
                                        <p>The 0.Collection Jobs must be run first and in order. The other SQL Solution sub-job groups can be run in any order, together or individually, after running the 0.Collection Job Group. </p>
                                        <p class="Recommended-1" data-mc-autonum="&lt;span style=&quot;color: #fb8000;&quot; class=&quot;mcFormatColor&quot;&gt;&lt;b&gt;&lt;i&gt;RECOMMENDED: &lt;/i&gt;&lt;/b&gt;&lt;/span&gt;"><span class="autonumber"><span class="Recommended"><span style="color: #fb8000;" class="mcFormatColor"><b><i>RECOMMENDED: </i></b></span></span></span>Run the solution at the top level.</p>
                                        <p class="Bold_Subheading">Workflow</p>
                                        <p>Prerequisites:</p>
                                        <ul>
                                            <li>Successful execution of the .Active Directory Inventory Job Group</li>
                                            <li>For the 3-SQL_ActivityScan, configure SQL Server Audit and SQL Server Audit Specifications on target SQL Server Databases. Audit destination for the configured server or database audit must be a binary file.</li>
                                            <li>The 5-SQL_ServerSettings Job contains the Orphaned Users query which returns users that are orphaned for each database. The query uses the sp_Change_users_login procedure which requires the db_owner fixed database to be assigned to the <span class="mc-variable SA.Product_Short_Name variable">Access Analyzer</span> User. See the <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql?view=sql-server-ver15" target="_blank" alt=" sp_change_users_login (Transact-SQL)">sp_change_users_login (Transact-SQL)</a> Microsoft article for additional information. </li>
                                        </ul>
                                        <ol>
                                            <li value="1"><span style="font-style: italic;">(Optional)</span> Configure the queries for the jobs in the 0.Collection Job Group</li>
                                            <li value="2">
                                                <p>Schedule the 0.Collection Job Group to run daily or as desired</p>
                                                <p class="Note-1" data-mc-autonum="&lt;b&gt;NOTE: &lt;/b&gt;"><span class="autonumber"><span class="Note"><b>NOTE: </b></span></span>Running the 0.Collection Job Group is a prerequisite for the other job groups in the SQL solution</p>
                                            </li>
                                            <li value="3">Review the reports generated by the 0.Collection Job Group’s jobs</li>
                                        </ol>
                                        <h2>Azure SQL 0.Collection Job Group</h2>
                                        <p>The Azure SQL Solution has been configured to inherit down from the <span style="font-weight: bold;">Azure SQL</span> &gt; <span style="font-weight: bold;">Settings</span> node. However, it is best practice to assign the host list and the Connection Profile at the data collection level, the 0.Collection Job Group. Once these are assigned to the job group, it can be run directly or scheduled.</p>
                                        <p class="Bold_Subheading">Dependencies</p>
                                        <ul>
                                            <li>
                                                <p>Full registration within Microsoft's Azure portal:</p>
                                                <ul>
                                                    <li>
                                                        <p>Creation of a <span class="mc-variable SA._Product_Short_Name variable">Access Analyzer</span> Azure SQL&#160;Role in the Access control (IAM)&#160;section</p>
                                                    </li>
                                                    <li>
                                                        <p>Successful registration of the <span class="mc-variable SA._Product_Short_Name variable">Access Analyzer</span> app</p>
                                                    </li>
                                                    <li>
                                                        <p>Successful creation of an Application (client)&#160;ID</p>
                                                    </li>
                                                </ul>
                                            </li>
                                            <li>
                                                <p>Successful configuration of an AzureSQL-specific connection profile</p>
                                            </li>
                                            <li>
                                                <p>Creation of an Azure Tenancy host list (ex. COMPANY.onmicrosoft.com) and Azure Active Directory user credential(s)</p>
                                                <p class="Recommended-1" data-mc-autonum="&lt;span style=&quot;color: #fb8000;&quot; class=&quot;mcFormatColor&quot;&gt;&lt;b&gt;&lt;i&gt;RECOMMENDED: &lt;/i&gt;&lt;/b&gt;&lt;/span&gt;"><span class="autonumber"><span class="Recommended"><span style="color: #fb8000;" class="mcFormatColor"><b><i>RECOMMENDED: </i></b></span></span></span>To avoid functional issues with <span class="mc-variable SA._Product_Short_Name variable">Access Analyzer</span>, create multiple connection profiles to accommodate multiple credentials.</p>
                                            </li>
                                            <li>
                                                <p>Define and validate connection information in the Connection screen</p>
                                            </li>
                                            <li>
                                                <p><a href="../AzureSQL/Collection/0-AzureSQL_InstanceDiscovery.htm" target="_parent" title="0-AzureSQL_InstanceDiscovery Job" alt="0-AzureSQL_InstanceDiscovery Job" class="MCXref xref">0-AzureSQL_InstanceDiscovery Job</a> run successfully</p>
                                            </li>
                                        </ul>
                                        <p class="Bold_Subheading">Targeted Host(s)</p>
                                        <p>The 0.Collection Job Group has been set to run against the following default dynamic host list:</p>
                                        <ul>
                                            <li>All targeted Azure SQL Tenants</li>
                                        </ul>
                                        <p class="Bold_Subheading">Connection Profile </p>
                                        <p>The SQL Data Collector requires a specific set of permissions. See the Permissions section for necessary permissions. The account used can be either an Active Directory account with database login enabled or a SQL account. Once the account has been provisioned, create a custom Connection Profile containing the credentials for the targeted environment. See the <a href="../../../Admin/DataCollector/SQL/ConfigureJob.htm" target="_parent" title="Navigates to the SQL Custom Connection Profile &amp; Default Dynamic Host List section" alt="Navigates to the SQL Custom Connection Profile &amp; Default Dynamic Host List section" class="MCXref xref">SQL&#160;Custom Connection Profile &amp; Default Dynamic Host List</a> topic for additional information.</p>
                                        <p>The Connection Profile should be assigned under the <b>Databases</b> &gt;  <span style="font-weight: bold;">0.Collection</span> &gt; <span style="font-weight: bold;">Azure SQL</span> &gt; <span style="font-weight: bold;">Settings</span> &gt; <span style="font-weight: bold;">Connection</span> node. It is set to <span style="font-weight: bold;">Use the Default Profile</span>, as configured at the global settings level. However, since this may not be the Connection Profile with the necessary permissions for the assigned hosts, click the radio button for the <span style="font-weight: bold;">Select one of the following user defined profiles</span> option and select the appropriate Connection Profile drop-down menu. </p>
                                        <p>See the <a href="../../../Admin/Settings/Connection/Overview.htm" target="_parent" title="Navigates to the Connection section" alt="Navigates to the Connection section" class="MCXref xref">Connection</a> topic for additional information.</p>
                                        <p class="Bold_Subheading">Schedule Frequency</p>
                                        <p>One of the most important decisions to make is how frequently to collect this data. The Azure SQL Job Group can be scheduled to run as desired depending on the types of auditing being conducted and the scope of the target environment. The general recommendation is to schedule the solution to run daily. </p>
                                        <p class="Bold_Subheading">Run Order</p>
                                        <p>The 0.Collection Jobs must be run first and in order. The other Azure SQL Solution sub-job groups can be run in any order, together or individually, after running the 0.Collection Job Group. </p>
                                        <p class="Recommended-1" data-mc-autonum="&lt;span style=&quot;color: #fb8000;&quot; class=&quot;mcFormatColor&quot;&gt;&lt;b&gt;&lt;i&gt;RECOMMENDED: &lt;/i&gt;&lt;/b&gt;&lt;/span&gt;"><span class="autonumber"><span class="Recommended"><span style="color: #fb8000;" class="mcFormatColor"><b><i>RECOMMENDED: </i></b></span></span></span>Run the solution at the top level.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>