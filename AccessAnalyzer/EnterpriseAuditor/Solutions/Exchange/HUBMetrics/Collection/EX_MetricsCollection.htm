<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_Stealthbits_WebsiteSkin" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../../" data-mc-has-content-body="True" data-mc-toc-path="[%=System.LinkedTitle%]|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../../../../Skins/Favicons/browserconfig.xml" />
        <link rel="shortcut icon" href="../../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="32x32" href="../../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../../../Skins/Favicons/favicon-16x16.png" /><title>EX_MetricsCollection Job</title>
        <link href="../../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <link rel="shortcut icon" href="../../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="32x32" href="../../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../../../Skins/Favicons/favicon-16x16.png" />
        <script src="../../../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="complementary" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="Main navigation and search" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../../Overview.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <div class="nocontent">
                                        <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                        </div>
                                    </div>
                                    <p>
                                        <script type="text/javascript" src="../../../../../Resources/zzJavaScript/plugins.min.js">
                                        </script>
                                    </p>
                                    <div role="main" id="mc-main-content">
                                        <h1>EX_MetricsCollection Job</h1>
                                        <p>The EX_MetricsCollection Job is comprised of multiple queries that utilize the ExchangeMetrics Data Collector to process and collect the message tracking logs on the Exchange servers in the environment. These queries collect server, domain, user, and distribution list traffic including but not limited to: sent, received, journal, NDRs, and transports messages. These queries are configured to process and collect that previous 7 days of Message Tracking Logs the first time this job is run, after that it only collects the previous day unless the <b>Enable Persistent Log State</b> option has been enabled in the query. </p>
                                        <p class="Recommended-1" data-mc-autonum="&lt;span style=&quot;color: #fb8000;&quot; class=&quot;mcFormatColor&quot;&gt;&lt;b&gt;&lt;i&gt;RECOMMENDED: &lt;/i&gt;&lt;/b&gt;&lt;/span&gt;"><span class="autonumber"><span class="Recommended"><span style="color: #fb8000;" class="mcFormatColor"><b><i>RECOMMENDED: </i></b></span></span></span>Run this job with the default configuration settings for all queries.</p>
                                        <p>See the <a href="../../../../Admin/DataCollector/ExchangeMetrics/Overview.htm" title="ExchangeMetrics Data Collector" alt="ExchangeMetrics Data Collector" target="_parent" class="MCXref xref">ExchangeMetrics Data Collector</a> topic for additional information. </p>
                                        <h2>Queries for the EX_MetricsCollection Job</h2>
                                        <p>The EX_MetricsCollection Job uses the ExchangeMetrics Data Collector.</p>
                                        <p style="text-align: center;">
                                            <img src="../../../../../Resources/Images/EnterpriseAuditor/Solutions/Exchange/HUBMetrics/Collection/MetricsCollectionQueries.png" title="Queries for the EX_MetricsCollection Job" alt="Queries for the EX_MetricsCollection Job" />
                                        </p>
                                        <p>The following queries are included in the EX_MetricsCollection Job:</p>
                                        <ul>
                                            <li>
                                                <p>Server Metrics – Collects server metrics</p>
                                            </li>
                                            <li>
                                                <p>User Metrics – Collects user metrics</p>
                                            </li>
                                            <li>
                                                <p>Internet Traffic Metrics – Collects internet traffic metrics</p>
                                            </li>
                                            <li>
                                                <p>Distribution List Metrics – Collects distribution list metrics</p>
                                            </li>
                                            <li>
                                                <p>Message Size Metrics – Collects message size metrics</p>
                                            </li>
                                            <li>
                                                <p>Delivery Time – Collects delivery times metrics</p>
                                            </li>
                                            <li>
                                                <p>Hourly Statistics – Collects server metrics</p>
                                            </li>
                                        </ul>
                                        <h2>Analysis Tasks for the EX_MetrixCollection Job</h2>
                                        <p>View the analysis tasks by navigating to the <b>Exchange</b> &gt; <b>1. HUB Metrics</b> &gt; <b>0. Collection</b> &gt; <b>EX_MetricsCollection</b> &gt; <b>Configure</b> node and selecting <b>Analysis</b>. </p>
                                        <p class="Caution" data-mc-autonum="&lt;span style=&quot;color: #da0000;&quot; class=&quot;mcFormatColor&quot;&gt;&lt;b&gt;CAUTION: &lt;/b&gt;&lt;/span&gt;"><span class="autonumber"><span class="Caution"><span style="color: #da0000;" class="mcFormatColor"><b>CAUTION: </b></span></span></span>Do not modify or deselect the selected analysis tasks. The analysis tasks are preconfigured for this job.</p>
                                        <p style="text-align: center;">
                                            <img src="../../../../../Resources/Images/EnterpriseAuditor/Solutions/Exchange/HUBMetrics/Collection/MetricsCollectionAnalysis.png" title="Analysis Tasks for the EX_MetrixCollection Job" alt="Analysis Tasks for the EX_MetrixCollection Job" />
                                        </p>
                                        <p>The following analysis tasks are selected by default:</p>
                                        <ul>
                                            <li>
                                                <p>01. Delivery Times History – Creates the SA_ExhangeMetrics_DeliveryTimes table, accessible under the job’s Results node</p>
                                            </li>
                                            <li>
                                                <p>02. DL History – Creates the SA_EX_ ExhangeMetrics_DistributionLists table, accessible under the job’s Results node</p>
                                            </li>
                                            <li>
                                                <p>03. Internet Traffic History – Creates the SA_EX_ExhangeMetrics_InternetTraffic table, accessible under the job’s Results node</p>
                                            </li>
                                            <li>
                                                <p>04. Hourly Traffic History – Creates the SA_EX_ExhangeMetrics_HourlyTraffic table, accessible under the job’s Results node</p>
                                            </li>
                                            <li>
                                                <p>05. User Traffic History – Creates the SA_EX_ExhangeMetrics_UserTraffic table, accessible under the job’s Results node</p>
                                            </li>
                                            <li>
                                                <p>06. Message Size History – Creates the SA_EX_ExhangeMetrics_MessageSize table, accessible under the job’s Results node</p>
                                            </li>
                                            <li>
                                                <p>07. Server Traffic History – Creates the SA_EX_ExhangeMetrics_ServerTraffic table, accessible under the job’s Results node</p>
                                            </li>
                                            <li>
                                                <p>08. SET HISTORY RETENTION – Sets retention period in months</p>
                                                <ul>
                                                    <li>
                                                        <p>By default set to retain <b>6 months</b></p>
                                                    </li>
                                                    <li>
                                                        <p>This retention period can be modified. See the <a href="#Exchange_History_Retention" title="Exchange History Retention" alt="Exchange History Retention" target="_parent" class="MCXref xref">Exchange History Retention</a> topic for additional information.</p>
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                                        <p>The following analysis task deletes table data from data collection and analysis jobs. This analysis task should remain deselected unless specifically needed:</p>
                                        <p class="Caution" data-mc-autonum="&lt;span style=&quot;color: #da0000;&quot; class=&quot;mcFormatColor&quot;&gt;&lt;b&gt;CAUTION: &lt;/b&gt;&lt;/span&gt;"><span class="autonumber"><span class="Caution"><span style="color: #da0000;" class="mcFormatColor"><b>CAUTION: </b></span></span></span>Do not select the <b>00. Deletes all Stored Data</b> option. This analysis task is for troubleshooting and cleanup only. Data will be deleted from the database.</p>
                                        <ul>
                                            <li>
                                                <p>00. Deletes all Stored Data - LEAVE UNCHECKED – Clears all historical data</p>
                                                <ul>
                                                    <li>
                                                        <p>See the <a href="#Troubleshooting_Data_Collection" title="Troubleshooting Data Collection" alt="Troubleshooting Data Collection" target="_parent" class="MCXref xref">Troubleshooting Data Collection</a> topic for additional information</p>
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                                        <h2><a name="Exchange_History_Retention"></a>Exchange History Retention</h2>
                                        <p>The <b>08. SET HISTORY RETENTION</b> analysis task controls the retention period for the job’s data. This is why the Data Retention Period options at the global, job group, or job Properties settings are not supported for the job group. The number of months can be modified. If desired, the parameter can be set to a specified number of days. Follow these steps to modify the history retention period.</p>
                                        <p class="Step-Reset" data-mc-autonum="&lt;b&gt;Step 1 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 1 – </b></span></span>Navigate to the job’s <b>Configure</b> node and select <b>Analysis</b>.</p>
                                        <p style="text-align: center;">
                                            <img src="../../../../../Resources/Images/EnterpriseAuditor/Solutions/Exchange/HUBMetrics/Collection/SetHistoryRetentionTask.png" title="08. SET HISTORY RETENTION task in the Analysis Selection view" alt="08. SET HISTORY RETENTION task in the Analysis Selection view" />
                                        </p>
                                        <p class="Step" data-mc-autonum="&lt;b&gt;Step 2 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 2 – </b></span></span>In the Analysis Selection view, select the <b>08. SET HISTORY RETENTION</b> analysis task and click <b>Analysis Configuration</b>. The SQL Script Editor opens.</p>
                                        <p style="text-align: center;">
                                            <img src="../../../../../Resources/Images/EnterpriseAuditor/Solutions/Exchange/HUBMetrics/Collection/SetHistoryRetentionScriptEditor.png" title="History Retention task in SQL Script Editor" alt="History Retention task in SQL Script Editor" />
                                        </p>
                                        <p class="Step" data-mc-autonum="&lt;b&gt;Step 3 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 3 – </b></span></span>To modify the number of months: On line 6, modify the value for the months parameter: </p>
                                        <p style="margin-left: 36pt;">Skip to Step 5.</p>
                                        <p class="Step" data-mc-autonum="&lt;b&gt;Step 4 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 4 – </b></span></span>To change the period parameter from months to days: </p>
                                        <ul>
                                            <li>
                                                <p>Comment out  lines 4, 6, and 8 which contain the months parameter. To comment out a line add <code>--</code> preceding it. The months parameter section should be as follows:</p>
                                                <div class="codeSnippet">
                                                    <div style="mc-code-lang: SQL;" class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code><span style="color: #969896; ">--Sets Retention Period in Months</span><br /><span style="color: #969896; ">--Declare @Months Float</span><br /><span style="color: #969896; ">--To Change the numbers of months to keep, Modify this value</span><br /><span style="color: #969896; ">--set @Months = 6</span><br /><span style="color: #969896; ">--Creates RetentionPeriod to be utilize in Where Clause</span><br /><span style="color: #969896; ">--Set @RetentionPeriod = CAST(DATEADD(MM, -@Months, GETDATE()) AS DATE)</span></code></pre>
                                                    </div>
                                                </div>
                                            </li>
                                            <li>
                                                <p>Uncomment out (remove <code>--</code> from) lines 12, 13, and 14 (which contain the days parameter). The days parameter section should be as follows:</p>
                                            </li>
                                            <li>
                                                <p>If desired, modify the number of days on line 13. The default days parameter is set to 30 days.</p>
                                            </li>
                                        </ul>
                                        <p class="Step" data-mc-autonum="&lt;b&gt;Step 5 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 5 – </b></span></span>Click <b>Save and Close</b>. The SQL Script Editor closes. </p>
                                        <p>The modified history retention period is now applied during future job executions.</p>
                                        <h2><a name="Troubleshooting_Data_Collection"></a>Troubleshooting Data Collection</h2>
                                        <p>There might be times when it is necessary to purge the data either through dropping the tables from the database or truncating the data within the tables. This option is provided through ananalysis task that is not selected by default. Only one analysis task within a job should be enabled when the desire is to purge that database.</p>
                                        <p class="Caution" data-mc-autonum="&lt;span style=&quot;color: #da0000;&quot; class=&quot;mcFormatColor&quot;&gt;&lt;b&gt;CAUTION: &lt;/b&gt;&lt;/span&gt;"><span class="autonumber"><span class="Caution"><span style="color: #da0000;" class="mcFormatColor"><b>CAUTION: </b></span></span></span>This analysis task deletes information collected or produced by jobs in this solution.</p>
                                        <p>Follow these steps to troubleshoot data collection:</p>
                                        <p class="Step-Reset" data-mc-autonum="&lt;b&gt;Step 1 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 1 – </b></span></span>Navigate to the job’s <b>Configure</b> node and select <b>Analysis</b>.</p>
                                        <p style="text-align: center;">
                                            <img src="../../../../../Resources/Images/EnterpriseAuditor/Solutions/Exchange/HUBMetrics/Collection/TroubleshootingTaskSelection.png" title="Troubleshooting task selection" alt="Troubleshooting task selection" />
                                        </p>
                                        <p class="Step" data-mc-autonum="&lt;b&gt;Step 2 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 2 – </b></span></span>In the Analysis Selection view, clear all default analysis tasks (if any) and select the analysis task which purges data. </p>
                                        <p class="Remember" data-mc-autonum="&lt;span style=&quot;color: #fb8000;&quot; class=&quot;mcFormatColor&quot;&gt;&lt;i&gt;Remember, &lt;/i&gt;&lt;/span&gt;"><span class="autonumber"><span class="Remember"><span style="color: #fb8000;" class="mcFormatColor"><i>Remember, </i></span></span></span>only one task should be selected.</p>
                                        <p class="Step" data-mc-autonum="&lt;b&gt;Step 3 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 3 – </b></span></span>In the Navigation pane, right-click the <b>Analysis</b> node and select <b>Execute Analyses</b>.</p>
                                        <p class="Step" data-mc-autonum="&lt;b&gt;Step 4 – &lt;/b&gt;"><span class="autonumber"><span class="Step"><b>Step 4 – </b></span></span>After the analysis task has been executed, return to the Analysis Selection view. Deselect the analysis task which was executed and reselect the default analysis tasks (if any had been cleared in Step 2).</p>
                                        <p>The selected purge of data and tables has taken place, and the analysis tasks have been reset to the default state.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>