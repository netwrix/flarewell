<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_Stealthbits_WebsiteSkin" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../" data-mc-has-content-body="True" data-mc-toc-path="[%=System.LinkedTitle%]|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../../../Skins/Favicons/browserconfig.xml" />
        <link rel="shortcut icon" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="32x32" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../../Skins/Favicons/favicon-16x16.png" /><title>Script Example 2:&#160;Command Query</title>
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Resources/Stylesheets/StealthbitsTemplate.css" rel="stylesheet" type="text/css" />
        <link rel="shortcut icon" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="32x32" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../../Skins/Favicons/favicon-16x16.png" />
        <script src="../../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="complementary" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" aria-label="Main navigation and search" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../Overview.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <div class="nocontent">
                                        <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                        </div>
                                    </div>
                                    <p>
                                        <script type="text/javascript" src="../../../../Resources/zzJavaScript/plugins.min.js">
                                        </script>
                                    </p>
                                    <div role="main" id="mc-main-content">
                                        <h1>Script Example 2:&#160;Command Query</h1>
                                        <p>The following example illustrates the use of scripts within <span class="mc-variable SA.Product_Short_Name variable">Access Analyzer</span>. This script reads a database list from SQL Server and then proceeds to the File System Data Collector for the size of the database file, essentially inventorying the installed databases, their paths, and sizes. </p>
                                        <p class="Note-1" data-mc-autonum="&lt;b&gt;NOTE: &lt;/b&gt;"><span class="autonumber"><span class="Note"><b>NOTE: </b></span></span>Because the object instances are not thread-safe, scripts like these that use objects external to <span class="mc-variable SA.Product_Short_Name variable">Access Analyzer</span> should be run with only one thread.</p>
                                        <p>In this example, a connection is opened with a SQL server. The SQL server name is provided by <span class="mc-variable SA.Product_Short_Name variable">Access Analyzer</span> during the query. <span class="mc-variable SA.Product_Short_Name variable">Access Analyzer</span> provides the active host to the script using the <b>Query.Host</b> property.</p>
                                        <p>The script then queries the Master database, requesting a <b>recordset</b> containing all databases and proceeds to get the row count. Setting the <b>Query.ResultRows</b> property creates a row of storage for each record in the recordset. It then proceeds to read data from each row by looping row by row. For each row, the database name, filename, and ID are captured. The script then calls a function to get the size of the file. The <b>FileSize</b> function uses the database filename to construct a query to the File System Data Collector, which ultimately returns the size of the file.</p>
                                        <p>The data for each database is stored in the Query object. </p>
                                        <p>Finally, the SQL objects are freed.</p>
                                        <h2>Example of Compound Query Script</h2>
                                        <p>The compound query script example is:</p>
                                        <div class="codeSnippet">
                                            <div style="mc-code-lang: VB;" class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code><span style="color: #a71d5d; ">Sub</span> Task()<br />&#160;<br /><span style="color: #a71d5d; ">Const</span> adOpenStatic = 3<br /><span style="color: #a71d5d; ">Const</span> adLockPessimistic = 2<br />&#160;<br /><span style="color: #a71d5d; ">Dim</span> cnnSQL<br /><span style="color: #a71d5d; ">Dim</span> rstSQL<br /><span style="color: #a71d5d; ">Dim</span> I<br /><span style="color: #a71d5d; ">Dim</span> sFilespec, sPath, sFile<br />&#160;<br /><span style="color: #969896; ">' CONNECT TO THE DATABASE</span><br /><span style="color: #969896; ">' **** NOTE *****</span><br /><span style="color: #969896; ">' Set Uid and pwd to username and password</span><br /><span style="color: #969896; ">' OR set both to blank for trusted connections</span><br />&#160;<br /><span style="color: #a71d5d; ">Set</span> cnnSQL = CreateObject(<span style="color: #df5000; ">"ADODB.Connection"</span>)<br />cnnSQL.Open <span style="color: #df5000; ">"Driver={SQL Server};"</span> &amp; _&#160;<br /><span style="color: #df5000; ">"Server="</span> &amp; Query.Host &amp; <span style="color: #df5000; ">";"</span> &amp; _<br /><span style="color: #df5000; ">"Database=Master;"</span> &amp; _<br /><span style="color: #df5000; ">"Uid=SA;"</span> &amp; _&#160;<br /><span style="color: #df5000; ">"Pwd="</span><br /><span style="color: #a71d5d; ">Set</span> rstSQL = CreateObject(<span style="color: #df5000; ">"ADODB.Recordset"</span>)<br />rstSQL.Open <span style="color: #df5000; ">"SELECT dbid, name, filename FROM sysdatabases;"</span>, cnnSQL, _<br />adOpenStatic, adLockPessimistic<br />&#160;<br /><span style="color: #969896; ">' AS LONG AS RECORDS CAME BACK, PROCEED TO CAPTURE DATABASE INFO</span><br />&#160;<br /><span style="color: #a71d5d; ">If</span> <span style="color: #0086b3; ">NOT</span>(rstSQL.EOF) <span style="color: #a71d5d; ">Then</span><br />Query.ResultRows=rstSQL.RecordCount<br />rstSQL.MoveFirst<br /><span style="color: #a71d5d; ">For</span> i=0 <span style="color: #a71d5d; ">to</span> Query.ResultRows-1<br />Query.ResultRow=i<br />Query.ResultData(<span style="color: #df5000; ">"DbId"</span>)=rstSQL.Fields(<span style="color: #df5000; ">"dbid"</span>)<br />Query.ResultData(<span style="color: #df5000; ">"Name"</span>)=rstSQL.Fields(<span style="color: #df5000; ">"name"</span>)<br />sFilespec=rstSQL.Fields(<span style="color: #df5000; ">"filename"</span>)<br />SplitPath sFileSpec, sPath, sFile<br />Query.ResultData(<span style="color: #df5000; ">"Path"</span>)=sPath<br />&#160;<br /><span style="color: #969896; ">'GET DB SIZE</span><br />&#160;<br />iSize=GetFileSize(Query.Host, sPath, sFile)<br />Query.ResultData(<span style="color: #df5000; ">"Size"</span>)=iSize<br />&#160;<br /><span style="color: #969896; ">'MOVE TO NEXT DB</span><br />rstSQL.MoveNext<br />&#160;<br /><span style="color: #a71d5d; ">Next</span><br />&#160;<br /><span style="color: #a71d5d; ">End</span> <span style="color: #a71d5d; ">If</span><br />&#160;<br /><span style="color: #969896; ">' CLEAN UP</span><br />&#160;<br />rstSQL.Close<br /><span style="color: #a71d5d; ">Set</span> rstSQL = <span style="color: #63a35c; ">Nothing</span><br />&#160;<br />cnnSQL.Close<br /><span style="color: #a71d5d; ">Set</span> cnnSQL = <span style="color: #63a35c; ">Nothing</span><br />&#160;<br /><span style="color: #a71d5d; ">End</span> <span style="color: #a71d5d; ">Sub</span><br />&#160;<br /><span style="color: #969896; ">'---------------------------------------------------------------------</span><br />&#160;<br /><span style="color: #a71d5d; ">Function</span> GetFileSize (sHost, sPath, sFile)<br />&#160;<br />sFile=Chr(34) &amp; sFile &amp; Chr(34)<br />sPath=Chr(34) &amp; sPath &amp; Chr(34)<br />WorkingQuery.Reset<br />WorkingQuery.Host=Query.Host<br />WorkingQuery.Source=<span style="color: #df5000; ">"FILE"</span><br />sQueryPath=<span style="color: #df5000; ">"Type=FILEPATH?FilePath="</span> &amp; sPath &amp; _<br /><span style="color: #df5000; ">"?Target=FILES?FileSpec="</span> &amp; sFile &amp; _<br /><span style="color: #df5000; ">"?SubFolders=FALSE?GroupSize=FALSE?Units=Mb"</span><br />WorkingQuery.Paths1<br />WorkingQuery.Path(0)=sQueryPath<br />WorkingQuery.AddProperty(<span style="color: #df5000; ">"NAME=Size,DATATYPE=NUMERIC,VALUE="</span>)<br />WorkingQuery.Execute<br />WorkingQuery.ResultRow=0<br />&#160;<br />GetFileSize=WorkingQuery.ResultData(<span style="color: #df5000; ">"Size"</span>)<br />&#160;<br /><span style="color: #a71d5d; ">End</span> <span style="color: #a71d5d; ">Function</span><br />&#160;<br /><span style="color: #969896; ">'---------------------------------------------------------------------</span><br />&#160;<br /><span style="color: #a71d5d; ">Sub</span> SplitPath(sFileSpec, <span style="color: #a71d5d; ">ByRef</span> sPath, <span style="color: #a71d5d; ">ByRef</span> sFile)<br /><span style="color: #a71d5d; ">Dim</span> iPos<br /><span style="color: #a71d5d; ">If</span> sFileSpec&lt;&gt;<span style="color: #df5000; ">""</span> <span style="color: #a71d5d; ">then</span><br />iPos=instrRev(sFileSpec,<span style="color: #df5000; ">"\"</span>)<br />sPath=mid(sFileSpec,1,iPos-1)<br />sFile=mid(sFileSpec,iPos+1)<br /><span style="color: #a71d5d; ">End</span> <span style="color: #a71d5d; ">If</span><br /><span style="color: #a71d5d; ">End</span> <span style="color: #a71d5d; ">Sub</span><br /><span style="color: #969896; ">'---------------------------------------------------------------------</span><br /></code></pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>